
  CREATE OR REPLACE FORCE EDITIONABLE VIEW "PUBDB"."DESPESAS_EPM" ("MES", "ANO", "DATA_PEDIDO", "DATA_PROMET", "DATA_CONT", "DCT", "PEDIDO", "LINHA", "DOC", "LOTE", "POST", "CONTA", "VALOR_RECEBER", "VALOR_RECEBIDO", "COD_FORN", "FORNECEDOR", "RAZAO", "EMPRESA", "FILIAL", "GRUPO_CONTA", "SUBGRUPO_CONTA", "CONTA_CONTABIL", "CENTRO_CUSTO", "DESCRICAO_CC", "INTERCOMPANY_COLIGADAS", "AN8_FILIAL") AS 
  SELECT 

CASE
WHEN MES='1' THEN TO_cHAR(TO_DATE('01','MM'),'MM')
WHEN MES='2' THEN TO_cHAR(TO_DATE('02','MM'),'MM')
WHEN MES='3' THEN TO_cHAR(TO_DATE('03','MM'),'MM')
WHEN MES='4' THEN TO_cHAR(TO_DATE('04','MM'),'MM')
WHEN MES='5' THEN TO_cHAR(TO_DATE('05','MM'),'MM')
WHEN MES='6' THEN TO_cHAR(TO_DATE('06','MM'),'MM')
WHEN MES='7' THEN TO_cHAR(TO_DATE('07','MM'),'MM')
WHEN MES='8' THEN TO_cHAR(TO_DATE('08','MM'),'MM')
WHEN MES='9' THEN TO_cHAR(TO_DATE('09','MM'),'MM')
WHEN MES='10' THEN TO_cHAR(TO_DATE('10','MM'),'MM')
WHEN MES='11' THEN TO_cHAR(TO_DATE('11','MM'),'MM')
WHEN MES='12' THEN TO_cHAR(TO_DATE('12','MM'),'MM')
ELSE TO_cHAR(TO_DATE('01','MM'),'MM')
END MES,

'20'||ANO ANO,
CASE WHEN DATA_PEDIDO='01/01/1900' THEN '' ELSE TO_cHAR(DATA_PEDIDO,'DD/MM/YYYY') END DATA_PEDIDO,
CASE WHEN DATA_PROMET='01/01/1900' THEN '' ELSE TO_cHAR(DATA_PROMET,'DD/MM/YYYY') END DATA_PROMET,
CASE WHEN DATA_CONT='01/01/1900' THEN '' ELSE TO_cHAR(DATA_CONT,'DD/MM/YYYY') END DATA_CONT,
TIPO DCT,
PEDIDO,
LINHA,
DOC,
LOTE,
POST,
CONTA,
VALOR_RECEBER,
VALOR_RECEBIDO,
AN8 COD_FORN,
RAZAO FORNECEDOR,
RAZAO,
SUBSTR(KCO,1,2) EMPRESA,
FILIAL,
LEGENDA GRUPO_CONTA,
LEGENDA SUBGRUPO_CONTA,

trim(OBJ)||trim(SUB) CONTA_CONTABIL,

CENTRO CENTRO_CUSTO,
A.MCDL01 DESCRICAO_CC,
CASE
WHEN trim(OBJ)||trim(SUB)='411150001'  THEN 'INTERCOMPANY'
WHEN trim(OBJ)||trim(SUB)='411150002'  THEN 'INTERCOMPANY'
WHEN trim(OBJ)||trim(SUB)='411150003'  THEN 'COLIGADAS'
WHEN trim(OBJ)||trim(SUB)='411150004'  THEN 'COLIGADAS'
WHEN trim(OBJ)||trim(SUB)='311040001'  THEN 'INTERCOMPANY'
WHEN trim(OBJ)||trim(SUB)='311040002'  THEN 'INTERCOMPANY'
WHEN trim(OBJ)||trim(SUB)='311040003'  THEN 'INTERCOMPANY'
WHEN trim(OBJ)||trim(SUB)='311040004'  THEN 'INTERCOMPANY'
WHEN trim(OBJ)||trim(SUB)='311040005'  THEN 'COLIGADAS'
WHEN trim(OBJ)||trim(SUB)='311040006'  THEN 'COLIGADAS'
WHEN trim(OBJ)||trim(SUB)='311040007'  THEN 'COLIGADAS'
WHEN trim(OBJ)||trim(SUB)='311040008'  THEN 'COLIGADAS'
WHEN trim(OBJ)||trim(SUB)='311050001'  THEN 'INTERCOMPANY'
WHEN trim(OBJ)||trim(SUB)='311050002'  THEN 'INTERCOMPANY'
WHEN trim(OBJ)||trim(SUB)='311050003'  THEN 'COLIGADAS'
WHEN trim(OBJ)||trim(SUB)='311050004'  THEN 'COLIGADAS'
WHEN trim(OBJ)||trim(SUB)='312020001'  THEN 'INTERCOMPANY'
WHEN trim(OBJ)||trim(SUB)='312020002'  THEN 'INTERCOMPANY'
WHEN trim(OBJ)||trim(SUB)='312020001'  THEN 'COLIGADAS'
WHEN trim(OBJ)||trim(SUB)='312020002'  THEN 'COLIGADAS'
WHEN trim(OBJ)||trim(SUB)='312040001'  THEN 'INTERCOMPANY'
WHEN trim(OBJ)||trim(SUB)='312040002'  THEN 'INTERCOMPANY'
WHEN trim(OBJ)||trim(SUB)='312040003'  THEN 'INTERCOMPANY'
WHEN trim(OBJ)||trim(SUB)='312040004'  THEN 'INTERCOMPANY'
WHEN trim(OBJ)||trim(SUB)='312040005'  THEN 'INTERCOMPANY'
WHEN trim(OBJ)||trim(SUB)='312040006'  THEN 'INTERCOMPANY'
WHEN trim(OBJ)||trim(SUB)='312040007'  THEN 'INTERCOMPANY'
WHEN trim(OBJ)||trim(SUB)='312040008'  THEN 'INTERCOMPANY'
WHEN trim(OBJ)||trim(SUB)='312040009'  THEN 'COLIGADAS'
WHEN trim(OBJ)||trim(SUB)='312040010'  THEN 'COLIGADAS'
WHEN trim(OBJ)||trim(SUB)='312040011'  THEN 'COLIGADAS'
WHEN trim(OBJ)||trim(SUB)='312040012'  THEN 'COLIGADAS'
WHEN trim(OBJ)||trim(SUB)='312040013'  THEN 'COLIGADAS'
WHEN trim(OBJ)||trim(SUB)='312040014'  THEN 'COLIGADAS'
WHEN trim(OBJ)||trim(SUB)='312040015'  THEN 'COLIGADAS'
WHEN trim(OBJ)||trim(SUB)='312040016'  THEN 'COLIGADAS'
WHEN AN8 IN ('344473','71000') THEN 'COLIGADAS'
END INTERCOMPANY_COLIGADAS
,B.MCAN8 AN8_FILIAL
FROM PUBDB.DESPESAS_ANALYTICS
LEFT JOIN PRODDTA.F0006 A  ON TRIM(A.MCMCU) =CENTRO
LEFT JOIN PRODDTA.F0006 B  ON TRIM(B.MCMCU) =FILIAL;

