select
TO_CHAR(SYSDATE,'DD/MM/YYYY HH24:MI') ATUALIZACAO,
TRIM(A.imlitm) COD,
TRIM(A.IMSEG1) SEGMENTO,
TRIM(B.IMDSC1) DESCRICAO,
TRIM(LIMCU) AS FILIAL,
TRIM(MCDL01) AS FILIAL2,
SUM(LIPQOH/10000 ) QTD,
SUM((LIPQOH/10000 ) * NVL(G.COUNCS/10000,0) ) GERENCIAL_TOTAL,
B.IMUOM1 AS UM,
NVL(G.COUNCS/10000,0) GERENCIAL_UNIT,
NVL(C.COUNCS/10000,0) CONTABIL_UNIT,

TRIM(S1.DRDL01) AS CLASSE_LEG,
TRIM(S2.DRDL01) AS SUB_CLASSE_LEG

FROM PRODDTA.F41021
INNER JOIN PRODDTA.F4101 A  ON  A.IMITM=LIITM
INNER JOIN PRODDTA.F4101 B  ON  TRIM(A.IMSEG1)=TRIM(B.IMLITM)
INNER  JOIN PRODDTA.F0006  ON TRIM(MCMCU)=TRIM(LIMCU)
LEFT JOIN PRODDTA.F4105 G  ON (G.COMCU)='      111000' AND G.COLEDG='43' AND G.COLITM=B.IMLITM
LEFT JOIN PRODDTA.F4105 C  ON TRIM(C.COMCU)='111000' AND C.COCSIN='I'  AND C.COLITM=B.IMLITM

LEFT JOIN PRODCTL.F0005 S1 ON TRIM(S1.DRSY)='41' AND TRIM(S1.DRRT)='P1' AND TRIM(S1.DRKY)=TRIM(B.IMSRP1)
LEFT JOIN PRODCTL.F0005 S2 ON TRIM(S2.DRSY)='41' AND TRIM(S2.DRRT)='P2' AND TRIM(S2.DRKY)=TRIM(B.IMSRP2)

WHERE  
LIPQOH!=0
AND B.IMSRP5='MP'
and B.IMSTKT!='O'
AND TRIM(LILOCN) LIKE '3767%'
group by TRIM(A.IMSEG1),TRIM(LIMCU) ,TRIM(MCDL01) ,NVL(G.COUNCS/10000,0),NVL(C.COUNCS/10000,0),B.IMUOM1,TRIM(B.IMDSC1) 
,TRIM(S1.DRDL01) ,TRIM(S2.DRDL01),TRIM(A.imlitm)


union all



SELECT
TO_CHAR(SYSDATE,'DD/MM/YYYY HH24:MI') ATUALIZACAO,
TRIM(A.imlitm) COD,
TRIM(A.IMSEG1) SEGMENTO,
TRIM(B.IMDSC1) DESCRICAO,
TRIM(LIMCU) AS FILIAL,
TRIM(MCDL01) AS FILIAL2,
SUM(LIPQOH/10000 ) QTD,
SUM((LIPQOH/10000 ) * NVL(G.COUNCS/10000,0) ) GERENCIAL_TOTAL,
B.IMUOM1 AS UM,
NVL(G.COUNCS/10000,0) GERENCIAL_UNIT,
NVL(C.COUNCS/10000,0) CONTABIL_UNIT,

TRIM(S1.DRDL01) AS CLASSE_LEG,
TRIM(S2.DRDL01) AS SUB_CLASSE_LEG

FROM PRODDTA.F41021
INNER JOIN PRODDTA.F4101 A  ON  A.IMITM=LIITM
INNER JOIN PRODDTA.F4101 B  ON  TRIM(A.IMSEG1)=TRIM(B.IMLITM)
INNER  JOIN PRODDTA.F0006  ON TRIM(MCMCU)=TRIM(LIMCU)
LEFT JOIN PRODDTA.F4105 G  ON (G.COMCU)='      111000' AND G.COLEDG='43' AND G.COLITM=B.IMLITM
LEFT JOIN PRODDTA.F4105 C  ON TRIM(C.COMCU)='111000' AND C.COCSIN='I'  AND C.COLITM=B.IMLITM

LEFT JOIN PRODCTL.F0005 S1 ON TRIM(S1.DRSY)='41' AND TRIM(S1.DRRT)='P1' AND TRIM(S1.DRKY)=TRIM(B.IMSRP1)
LEFT JOIN PRODCTL.F0005 S2 ON TRIM(S2.DRSY)='41' AND TRIM(S2.DRRT)='P2' AND TRIM(S2.DRKY)=TRIM(B.IMSRP2)

WHERE  
LIPQOH!=0
AND B.IMSRP5='MP'
and B.IMSTKT!='O'


group by TRIM(A.IMSEG1),TRIM(LIMCU) ,TRIM(MCDL01) ,NVL(G.COUNCS/10000,0),NVL(C.COUNCS/10000,0),B.IMUOM1,TRIM(B.IMDSC1) 
,TRIM(S1.DRDL01) ,TRIM(S2.DRDL01),TRIM(A.imlitm)
