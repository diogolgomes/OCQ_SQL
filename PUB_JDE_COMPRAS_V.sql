
  CREATE OR REPLACE FORCE EDITIONABLE VIEW "PUBDB"."PUB_JDE_COMPRAS_V" ("EMISSAO", "DSC2", "SEG", "CLASSE_MERCADORIA", "SUBCLASSE_MERCADORIA", "GL", "GL_DSC", "ORIGINADOR", "CAT_5", "CIA", "FILIAL", "FILIAL2", "NF", "DPBRNOP", "PEDIDO", "LOTE", "PEDIDO_LINHA", "CATEGORIA_PED", "TIPO", "DATA_SOLICITACAO", "ENTREGA_PROMETIDA", "RECEBIMENTO", "DATA_RECEBIMENTO", "COD_FORNECEDOR", "FORNECEDOR", "COD", "DESCRICAO", "CATEGORIA", "SUB_CATEGORIA", "QTD_SOLICITADA", "UM", "QTD_RECEBIDA", "UM2", "PRECO_UNIT", "PRECO_TOTAL", "UNITARIO_DOLAR", "TOTAL_DOLAR", "ORIGEM", "UF_USO_ST", "ICMS", "UNIT_NET", "TOTAL_NET", "COFINS", "PIS", "COND_PAG", "ULT_STATUS", "PROX_STATUS", "CONTA_CONTABIL", "IPI", "IPI_PORC", "ALADDS", "PJBORI", "MOEDA", "COMPRADOR", "NEGOCIADOR", "CURVA_ABC", "LEAD", "MEDIA_COND_PAG", "MEDIA_FINAN") AS 
  WITH DADOS AS (


--A RECEBER
select 
DISTINCT 
'A RECEBER' TIPO_ENT,
TRIM(PDGLC) AS GL,
TRIM(GL.DRDL01) AS GL_DSC,
PDCO AS CIA,
TRIM(PDMCU) AS FILIAL,
TRIM(MCDL01) AS FILIAL2,
FDBNNF AS NF,

PDDOCO AS PEDIDO,
PRLOTN AS LOTE,
PDLNID/1000 PEDIDO_LINHA,
TO_CHAR('A RECEBER '||TRIM(PDDCTO)) CATEGORIA,
TRIM(PDDCTO) AS TIPO,
CASE WHEN PDDRQJ>0 THEN TO_DATE(TO_DATE((PDDRQJ+1900000), 'YYYYDDD'), 'DD/MM/RRRR')
ELSE TO_DATE(TO_DATE((1+1900000), 'YYYYDDD'), 'DD/MM/RRRR') END DATA_SOLICITACAO,
CASE WHEN PDPDDJ>0 THEN  TO_DATE(TO_DATE((PDPDDJ+1900000), 'YYYYDDD'), 'DD/MM/RRRR')
ELSE TO_DATE(TO_DATE((1+1900000), 'YYYYDDD'), 'DD/MM/RRRR')  END ENTREGA_PROMETIDA,
CASE WHEN PRRCDJ>0 THEN  TO_DATE(TO_DATE((PRRCDJ+1900000), 'YYYYDDD'), 'DD/MM/RRRR')
ELSE TO_DATE(TO_DATE((1+1900000), 'YYYYDDD'), 'DD/MM/RRRR')  END RECEBIMENTO,
TO_DATE(TO_DATE((1+1900000), 'YYYYDDD'), 'DD/MM/RRRR')  EMISSAO,

C.ABAN8 AS COD_FORNECEDOR,
TRIM(C.ABALPH) AS FORNECEDOR,
TRIM(PDLITM )AS  COD ,
TRIM(PDDSC1) AS DESCRICAO,
--TRIM(PDDSC2) AS DSC2 ,
TRIM(DF.DRDL01)||'('||trim(DF.DRKY)||')' as CLASSE_MERCADORIA,
TRIM(SB.DRDL01)||'('||trim(SB.DRKY)||')' as SUBCLASSE_MERCADORIA,
PDUOPN/10000 AS QNT_SOLICITADA,
TRIM(PDUOM) AS UM,
NVL(PRUREC,0)/10000 AS QTD_RECEBIDA,
PRUOM3 AS UM2,
PDPRRC/10000 AS PRECO_UNIT,
PDAEXP/100 AS PRECO_TOTAL,
PDFRRC/10000 UNITARIO_DOLAR,
PDFEA/100 TOTAL_DOLAR,

TRIM(PNPTD) AS COND_PAG,
PDLTTR AS ULT_STATUS,
PDNXTR AS PROX_STATUS,
TO_CHAR(TRIM(PDANI)) CONTA_CONTABIL,

CASE when TNBFIP = 1 THEN
				CASE When F76432.PJBCTF = '01' OR F76432.PJBCTF = '03' THEN 
					CASE When F4301.PHCRCD = 'BRL' THEN
						((F4311.PDUORG/10000 * F4311.PDPRRC/10000 * F76B18.FCTXR1/1000)/100)
					Else ((F4311.PDUORG/10000 * F4311.PDFRRC/10000 * F76B18.FCTXR1/1000)/100) End
				Else 0 END
			Else 0 END IPI,    


CASE when TNBFIP = 1 THEN
				CASE When F76432.PJBCTF = '01' OR F76432.PJBCTF = '03' THEN 
					(F76B18.FCTXR1/1000)
				Else 0 End
			Else 0 END IPI_PORC
,AL.ALADDS
,PJBORI
,PJBCTF
,PJBCFC
,TO_CHAR(TRIM(GMDL01)) AS LEGENDA
,CASE
WHEN TRIM(PDPODC01)='B20' THEN 'ADMINISTRATIVO-operacao'
WHEN TRIM(PDPODC01)='B21' THEN 'ADMINISTRATIVO-Invest'
WHEN TRIM(PDPODC01)='B22' THEN 'ATIVO-operacao'
WHEN TRIM(PDPODC01)='B23' THEN 'ATIVO-INVEST'
WHEN TRIM(PDPODC01)='B24' THEN 'PRODUCAO-operacao'
WHEN TRIM(PDPODC01)='B25' THEN 'PRODUCAO-INVEST'
WHEN TRIM(PDPODC01)='B26' THEN 'SALARIO'
WHEN TRIM(PDPODC01)='B27' THEN 'ESTOQUE'
END LEGENDA2
,DPBRNOP
,FDBST1

,TO_CHAR(pdTORG) as ORIGINADOR
,a.IMSRP5 AS CAT_5
,CASE 
when  F76432.PJBCTF  in ('03','04') then 0
WHEN C.TBTXR2 IS NOT NULL  THEN NVL(C.TBTXR2/1000,0)
ELSE 
NVL(B.TBTXR2/1000,0) END ICMS
,TO_CHAR(PDCRCD) MOEDA
,  TO_CHAR(PUBFPIS) PIS,

trim(A.imdsc2) as DSC2,
TRIM(A.IMSEG1) AS SEG
,TRIM(COMP.ABALKY) COMPRADOR
,TRIM(NEG.ABALKY) NEGOCIADOR
, TRIM(IbABCS) CURVA_ABC
,IbLTLV LEAD,
'' UKID
,case
when TO_CHAR(PUBFPIS)='Y' then 
(PDAEXP/100- (NVL(B.TBTXR2/100000,0)*PDAEXP/100))*0.0165 
else 0 end 
PIS_VALOR,
case
when TO_CHAR(PUBFPIS)='Y' then 
(PDAEXP/100- (NVL(B.TBTXR2/100000,0)*PDAEXP/100))*0.076 
else 0 end 
COFINS_VALOR
,NVL(B.TBTXR2/100000,0)*PDAEXP/100 VALOR_ICMS


from PRODdta.f4311
LEFT JOIN PRODDTA.F7611B ON FDDOCO=PDDOCO AND PDCO=FDCO AND TRIM(PDLITM)=TRIM(FDLITM) AND FDPDCT=PDDCTO AND PDLNID=FDLNID AND FDNXTR!='996'
Left Join PRODDTA.F4301  ON F4301.PHDOCO = F4311.PDDOCO
Left Join PRODDTA.F76432 ON F4311.PDDOCO  = F76432.PJDOCO AND F4311.PDLNID = F76432.PJLNID  and F4311.Pdkcoo = F76432.PJkcoo
Left Join PRODDTA.F76B18 ON F76B18.FCBCLF = F76432.PJBCLF
Left Join PRODDTA.F7615B ON F7615B.TNBNOP = F76432.PJBNOP AND F7615B.TNBSOP = F76432.PJBSOP
LEFT JOIN PRODDTA.F4101 A ON A.IMITM = PDITM
LEFT JOIN PRODDTA.F0101 C ON PDAN8=C.ABAN8 
LEFT JOIN PRODDTA.F0014 ON PNPTC=PDPTC 
LEFT JOIN PRODDTA.F43121 ON PRDCTO=PDDCTO AND PDKCOO=PRKCOO AND PRDOCO=PDDOCO AND PRLNID=PDLNID AND SUBSTR(TRIM(PRGLC),1,2) IN ('AT','AS')
LEFT JOIN PRODDTA.F0116 AL ON AL.ALAN8=PDAN8
LEFT JOIN PRODDTA.F0901 ON GMCO=PDCO AND PDAID=GMAID
left outer join PRODCTL.F0005 DF    ON trim(DF.DRKY) = TRIM(A.IMPRP1) and DF.DRSY = '41' AND DF.DRRT = 'P1'
left outer join PRODCTL.F0005 SB    ON trim(SB.DRKY) = TRIM(A.IMPRP2) and SB.DRSY = '41' AND SB.DRRT = 'P2' 
left outer join PRODCTL.F0005 GL    ON trim(GL.DRKY) = TRIM(PDGLC) and GL.DRSY = '41' AND GL.DRRT = '9' 
LEFT JOIN PRODDTA.F76B200 ON F76432.PJBNOP=DPBNOP    AND F7615B.TNBSOP =DPBSOP 
LEFT JOIN PRODDTA.F0006 ON /*TRIM(MCSTYL)='BP' AND*/ TRIM(PDMCU)=TRIM(MCMCU)
LEFT JOIN proddta.f0116  FIL ON PDSHAN=FIL.alan8
LEFT JOIN PRODDTA.F7608B B  ON  B.TBITM='0' AND TRIM(B.TBAC76)='*' AND TRIM(B.TBSHST)=TRIM(FIL.aladds) AND (AL.ALADDS)=(B.TBADDS) AND NVL(B.TBBORI,0)=NVL(PJBORI,0)
LEFT JOIN PRODDTA.F7608B C  ON PDITM=C.TBITM AND TRIM(C.TBSHST)=TRIM(FIL.aladds) AND TRIM(AL.ALADDS)=TRIM(C.TBADDS) AND C.TBBORI=PJBORI
LEFT JOIN PRODDTA.F76B003 ON TRIM(PJBCFC)=TRIM(PUBCFC)
left join proddta.f4102 on ibitm=imitm and ibmcu=pdmcu
left join proddta.f0101 COMP ON COMP.ABAN8=IbBUYR
left join proddta.f0101 NEG ON NEG.ABAN8=IbCARP

where 
 PRUREC IS NULL

AND PDLTTR !='980'
AND PDNXTR !='999'



UNION ALL 



--PE01 RECEBIDO



--A RECEBER
select 
DISTINCT 
'RECEBIDO' TIPO_ENT,
TRIM(PDGLC) AS GL,
TRIM(GL.DRDL01) AS GL_DSC,
PDCO AS CIA,
TRIM(PDMCU) AS FILIAL,
TRIM(MCDL01) AS FILIAL2,
FDBNNF AS NF,

PDDOCO AS PEDIDO,
PRLOTN AS LOTE,
PDLNID/1000 PEDIDO_LINHA,
TO_CHAR('RECEBIDO '||TRIM(PDDCTO)) CATEGORIA,
TRIM(PDDCTO) AS TIPO,
CASE WHEN PDDRQJ>0 THEN TO_DATE(TO_DATE((PDDRQJ+1900000), 'YYYYDDD'), 'DD/MM/RRRR')
ELSE TO_DATE(TO_DATE((1+1900000), 'YYYYDDD'), 'DD/MM/RRRR') END DATA_SOLICITACAO,
CASE WHEN PDPDDJ>0 THEN  TO_DATE(TO_DATE((PDPDDJ+1900000), 'YYYYDDD'), 'DD/MM/RRRR')
ELSE TO_DATE(TO_DATE((1+1900000), 'YYYYDDD'), 'DD/MM/RRRR')  END ENTREGA_PROMETIDA,
CASE WHEN PDPDDJ>0 THEN  TO_DATE(TO_DATE((PDPDDJ+1900000), 'YYYYDDD'), 'DD/MM/RRRR')
ELSE TO_DATE(TO_DATE((1+1900000), 'YYYYDDD'), 'DD/MM/RRRR')  END RECEBIMENTO,
TO_DATE(TO_DATE((1+1900000), 'YYYYDDD'), 'DD/MM/RRRR')  EMISSAO,

C.ABAN8 AS COD_FORNECEDOR,
TRIM(C.ABALPH) AS FORNECEDOR,
TRIM(PDLITM )AS  COD ,
TRIM(PDDSC1) AS DESCRICAO,
--TRIM(PDDSC2) AS DSC2 ,
TRIM(DF.DRDL01)||'('||trim(DF.DRKY)||')' as CLASSE_MERCADORIA,
TRIM(SB.DRDL01)||'('||trim(SB.DRKY)||')' as SUBCLASSE_MERCADORIA,
PDUOPN/10000 AS QNT_SOLICITADA,
TRIM(PDUOM) AS UM,
NVL(PRUREC,0)/10000 AS QTD_RECEBIDA,
PRUOM3 AS UM2,
PDPRRC/10000 AS PRECO_UNIT,
PDAEXP/100 AS PRECO_TOTAL,
PDFRRC/10000 UNITARIO_DOLAR,
PDFEA/100 TOTAL_DOLAR,

TRIM(PNPTD) AS COND_PAG,
PDLTTR AS ULT_STATUS,
PDNXTR AS PROX_STATUS,
TO_CHAR(TRIM(PDANI)) CONTA_CONTABIL,

CASE when TNBFIP = 1 THEN
				CASE When F76432.PJBCTF = '01' OR F76432.PJBCTF = '03' THEN 
					CASE When F4301.PHCRCD = 'BRL' THEN
						((F4311.PDUORG/10000 * F4311.PDPRRC/10000 * F76B18.FCTXR1/1000)/100)
					Else ((F4311.PDUORG/10000 * F4311.PDFRRC/10000 * F76B18.FCTXR1/1000)/100) End
				Else 0 END
			Else 0 END IPI,    


CASE when TNBFIP = 1 THEN
				CASE When F76432.PJBCTF = '01' OR F76432.PJBCTF = '03' THEN 
					(F76B18.FCTXR1/1000)
				Else 0 End
			Else 0 END IPI_PORC
,AL.ALADDS
,PJBORI
,PJBCTF
,PJBCFC
,TO_CHAR(TRIM(GMDL01)) AS LEGENDA
,CASE
WHEN TRIM(PDPODC01)='B20' THEN 'ADMINISTRATIVO-operacao'
WHEN TRIM(PDPODC01)='B21' THEN 'ADMINISTRATIVO-Invest'
WHEN TRIM(PDPODC01)='B22' THEN 'ATIVO-operacao'
WHEN TRIM(PDPODC01)='B23' THEN 'ATIVO-INVEST'
WHEN TRIM(PDPODC01)='B24' THEN 'PRODUCAO-operacao'
WHEN TRIM(PDPODC01)='B25' THEN 'PRODUCAO-INVEST'
WHEN TRIM(PDPODC01)='B26' THEN 'SALARIO'
WHEN TRIM(PDPODC01)='B27' THEN 'ESTOQUE'
END LEGENDA2
,DPBRNOP
,FDBST1

,TO_CHAR(pdTORG) as ORIGINADOR
,a.IMSRP5 AS CAT_5
,CASE 
when  F76432.PJBCTF  in ('03','04') then 0
WHEN C.TBTXR2 IS NOT NULL  THEN NVL(C.TBTXR2/1000,0)
ELSE 
NVL(B.TBTXR2/1000,0) END ICMS
,TO_CHAR(PDCRCD) MOEDA
,  TO_CHAR(PUBFPIS) PIS,

trim(A.imdsc2) as DSC2,
TRIM(A.IMSEG1) AS SEG
,TRIM(COMP.ABALKY) COMPRADOR
,TRIM(NEG.ABALKY) NEGOCIADOR
, TRIM(IbABCS) CURVA_ABC
,IbLTLV LEAD,
'' UKID
,case
when TO_CHAR(PUBFPIS)='Y' then 
(PDAEXP/100- (NVL(B.TBTXR2/100000,0)*PDAEXP/100))*0.0165 
else 0 end 
PIS_VALOR,
case
when TO_CHAR(PUBFPIS)='Y' then 
(PDAEXP/100- (NVL(B.TBTXR2/100000,0)*PDAEXP/100))*0.076 
else 0 end 
COFINS_VALOR
,NVL(B.TBTXR2/100000,0)*PDAEXP/100 VALOR_ICMS


from PRODdta.f4311
LEFT JOIN PRODDTA.F7611B ON FDDOCO=PDDOCO AND PDCO=FDCO AND TRIM(PDLITM)=TRIM(FDLITM) AND FDPDCT=PDDCTO AND PDLNID=FDLNID AND FDNXTR!='996'
Left Join PRODDTA.F4301  ON F4301.PHDOCO = F4311.PDDOCO
Left Join PRODDTA.F76432 ON F4311.PDDOCO  = F76432.PJDOCO AND F4311.PDLNID = F76432.PJLNID  and F4311.Pdkcoo = F76432.PJkcoo
Left Join PRODDTA.F76B18 ON F76B18.FCBCLF = F76432.PJBCLF
Left Join PRODDTA.F7615B ON F7615B.TNBNOP = F76432.PJBNOP AND F7615B.TNBSOP = F76432.PJBSOP
LEFT JOIN PRODDTA.F4101 A ON A.IMITM = PDITM
LEFT JOIN PRODDTA.F0101 C ON PDAN8=C.ABAN8 
LEFT JOIN PRODDTA.F0014 ON PNPTC=PDPTC 
LEFT JOIN PRODDTA.F43121 ON PRDCTO=PDDCTO AND PDKCOO=PRKCOO AND PRDOCO=PDDOCO AND PRLNID=PDLNID AND SUBSTR(TRIM(PRGLC),1,2) IN ('AT','AS')
LEFT JOIN PRODDTA.F0116 AL ON AL.ALAN8=PDAN8
LEFT JOIN PRODDTA.F0901 ON GMCO=PDCO AND PDAID=GMAID
left outer join PRODCTL.F0005 DF    ON trim(DF.DRKY) = TRIM(A.IMPRP1) and DF.DRSY = '41' AND DF.DRRT = 'P1'
left outer join PRODCTL.F0005 SB    ON trim(SB.DRKY) = TRIM(A.IMPRP2) and SB.DRSY = '41' AND SB.DRRT = 'P2' 
left outer join PRODCTL.F0005 GL    ON trim(GL.DRKY) = TRIM(PDGLC) and GL.DRSY = '41' AND GL.DRRT = '9' 
LEFT JOIN PRODDTA.F76B200 ON F76432.PJBNOP=DPBNOP    AND F7615B.TNBSOP =DPBSOP 
LEFT JOIN PRODDTA.F0006 ON /*TRIM(MCSTYL)='BP' AND*/ TRIM(PDMCU)=TRIM(MCMCU)
LEFT JOIN proddta.f0116  FIL ON PDSHAN=FIL.alan8
LEFT JOIN PRODDTA.F7608B B  ON  B.TBITM='0' AND TRIM(B.TBAC76)='*' AND TRIM(B.TBSHST)=TRIM(FIL.aladds) AND (AL.ALADDS)=(B.TBADDS) AND NVL(B.TBBORI,0)=NVL(PJBORI,0)
LEFT JOIN PRODDTA.F7608B C  ON PDITM=C.TBITM AND TRIM(C.TBSHST)=TRIM(FIL.aladds) AND TRIM(AL.ALADDS)=TRIM(C.TBADDS) AND C.TBBORI=PJBORI
LEFT JOIN PRODDTA.F76B003 ON TRIM(PJBCFC)=TRIM(PUBCFC)
left join proddta.f4102 on ibitm=imitm and ibmcu=pdmcu
left join proddta.f0101 COMP ON COMP.ABAN8=IbBUYR
left join proddta.f0101 NEG ON NEG.ABAN8=IbCARP

where 
 PDLTTR NOT BETWEEN '990' AND '980'
AND PDNXTR ='999'
and PDDCTO='OJ'






union ALL
--RECEBIDO








select 
DISTINCT
'RECEBIDO' TIPO_ENT,
TRIM(PDGLC) AS GL,
TRIM(GL.DRDL01) AS GL_DSC,
PDCO AS CIA,
TRIM(PDMCU) AS FILIAL,
TRIM(MCDL01) AS FILIAL2,
FDBNNF AS NF,
PDDOCO AS PEDIDO,
FDLOTN AS LOTE,
PDLNID/1000 PEDIDO_LINHA,
TO_CHAR('RECEBIDO '||TRIM(PDDCTO)) CATEGORIA,
TRIM(PDDCTO) AS TIPO,
CASE WHEN PDDRQJ>0 THEN  TO_DATE(TO_DATE((PDDRQJ+1900000), 'YYYYDDD'), 'DD/MM/RRRR')
ELSE TO_DATE(TO_DATE((1+1900000), 'YYYYDDD'), 'DD/MM/RRRR') END DATA_SOLICITACAO,
CASE WHEN PDPDDJ>0 THEN  TO_DATE(TO_DATE((PDPDDJ+1900000), 'YYYYDDD'), 'DD/MM/RRRR')
ELSE TO_DATE(TO_DATE((1+1900000), 'YYYYDDD'), 'DD/MM/RRRR') END ENTREGA_PROMETIDA,
CASE WHEN FHADDJ>0 THEN TO_DATE(TO_DATE((FHADDJ+1900000), 'YYYYDDD'), 'DD/MM/RRRR')
ELSE TO_DATE(TO_DATE((1+1900000), 'YYYYDDD'), 'DD/MM/RRRR')
 END RECEBIMENTO,
 CASE WHEN FHISSU>0 THEN  TO_DATE(TO_DATE((FHISSU+1900000), 'YYYYDDD'), 'DD/MM/RRRR')
ELSE TO_DATE(TO_DATE((1+1900000), 'YYYYDDD'), 'DD/MM/RRRR')
 END EMISSAO,

C.ABAN8 AS COD_FORNECEDOR,
TRIM(C.ABALPH) AS FORNECEDOR,
TRIM(PDLITM ) AS  COD,
TRIM(PDDSC1) AS DESCRICAO,
--TRIM(PDDSC2) AS DSC2 ,
TRIM(DF.DRDL01)||'('||trim(DF.DRKY)||')' as CLASSE_MERCADORIA,
TRIM(SB.DRDL01)||'('||trim(SB.DRKY)||')' as SUBCLASSE_MERCADORIA,
PDUORG/10000 AS QNT_SOLICITADA,
TRIM(PDUOM) AS UM,
FDUORG/10000 AS QTD_RECEBIDA,
FDUOM AS UM2,
FDUPRC/10000 AS PRECO_UNIT,
FDAEXP/100  PRECO_TOTAL,
PDFRRC/10000 UNITARIO_DOLAR,
PDFEA/100 TOTAL_DOLAR,

--PDAEXP/100 AS PRECO_TOTAL,
TRIM(PNPTD) AS COND_PAG,
PDLTTR AS ULT_STATUS,
PDNXTR AS PROX_STATUS,
TO_CHAR(TRIM(PDANI)) CONTA_CONTABIL,
FDBIPI/100 IPI,    
FDTXR2/100 IPI_PORC
,ALADDS
,PJBORI
,PJBCTF
,PJBCFC
,TO_CHAR(TRIM(GMDL01)) AS LEGENDA
,CASE
WHEN TRIM(PDPODC01)='B20' THEN 'ADMINISTRATIVO-operacao'
WHEN TRIM(PDPODC01)='B21' THEN 'ADMINISTRATIVO-Invest'
WHEN TRIM(PDPODC01)='B22' THEN 'ATIVO-operacao'
WHEN TRIM(PDPODC01)='B23' THEN 'ATIVO-INVEST'
WHEN TRIM(PDPODC01)='B24' THEN 'PRODUCAO-operacao'
WHEN TRIM(PDPODC01)='B25' THEN 'PRODUCAO-INVEST'
WHEN TRIM(PDPODC01)='B26' THEN 'SALARIO'
WHEN TRIM(PDPODC01)='B27' THEN 'ESTOQUE'
END LEGENDA2
,DPBRNOP
,FDBST1
--,PRUREC
,TO_CHAR(pdTORG) as ORIGINADOR
,A.IMSRP5 AS CAT_5
,NVL(FDTXR1/1000,0) ICMS
,TO_CHAR(PDCRCD) MOEDA
,
CASE 
WHEN PIS.TDBRTXA IS NULL THEN 'N'
WHEN PIS.TDBRTXA='0' THEN 'N'
WHEN PIS.TDBRTXA>0 THEN 'Y'
ELSE  TO_CHAR(PUBFPIS)
END  PIS,
trim(A.imdsc2) as DSC2,
TRIM(A.IMSEG1) AS SEG
,TRIM(COMP.ABALKY) COMPRADOR
,TRIM(NEG.ABALKY) NEGOCIADOR
, TRIM(IbABCS) CURVA_ABC
,IbLTLV LEAD
,TO_CHAR(FDUKID) UKID


,NVL(PIS.TDBRTXA/100,0) PIS_VALOR
,NVL(COFINS.TDBRTXA/100,0) COFINS_VALOR
,FDBICM/100 VALOR_ICMS

from PRODdta.f4311 

INNER JOIN PRODDTA.F7611B C ON FDDOCO=PDDOCO AND PDCO=FDCO AND TRIM(PDLITM)=TRIM(FDLITM) AND FDPDCT=PDDCTO AND PDLNID=FDLNID AND FDNXTR NOT IN ('996','998')  
LEFT JOIN PRODDTA.F7601B ON FDBNNF=FHBNNF AND FHN001=FDN001 AND FDDCT=FHDCT AND FHMCU=FDMCU AND FHCO=FDCO
left outer join PRODDTA.F43121  on PRDOCO = PDDOCO and PRDCTO = PDDCTO and PRMATC not in ('4','2') and trim(PRVINV) = trim(FDBNNF) and PRDOCO = FDDOCO and PRDCTO = FDPDCT and PRNLIN  = FDNLIN and  PRLNID = FDLNID --and f.pruclo <> '0'

Left Join PRODDTA.F4301  ON F4301.PHDOCO = F4311.PDDOCO
Left Join PRODDTA.F76432 ON F4311.PDDOCO  = F76432.PJDOCO AND F4311.PDLNID = F76432.PJLNID and F4311.Pdkcoo = F76432.PJkcoo
Left Join PRODDTA.F76B18 ON F76B18.FCBCLF = F76432.PJBCLF
Left Join PRODDTA.F7615B ON F7615B.TNBNOP = F76432.PJBNOP AND F7615B.TNBSOP = F76432.PJBSOP
INNER JOIN PRODDTA.F4101 A ON A.IMITM = PDITM
INNER JOIN PRODDTA.F0101 C ON PDAN8=C.ABAN8 
left join proddta.f4102 on ibitm=imitm and ibmcu=pdmcu
left join proddta.f0101 COMP ON COMP.ABAN8=IbBUYR
left join proddta.f0101 NEG ON NEG.ABAN8=IbCARP

LEFT JOIN PRODDTA.F0014 ON PNPTC=PDPTC 
LEFT JOIN PRODDTA.F0116 ON ALAN8=PDAN8
LEFT JOIN PRODDTA.F0901 ON GMCO=PDCO AND PDAID=GMAID
left outer join PRODCTL.F0005 DF    ON trim(DF.DRKY) = TRIM(A.IMPRP1) and DF.DRSY = '41' AND DF.DRRT = 'P1'
left outer join PRODCTL.F0005 SB    ON trim(SB.DRKY) = TRIM(A.IMPRP2) and SB.DRSY = '41' AND SB.DRRT = 'P2' 
left outer join PRODCTL.F0005 GL    ON trim(GL.DRKY) = TRIM(PDGLC) and GL.DRSY = '41' AND GL.DRRT = '9' 
LEFT JOIN PRODDTA.F76B200 ON F76432.PJBNOP=DPBNOP    AND F7615B.TNBSOP =DPBSOP 
LEFT JOIN PRODDTA.F0006 ON /*TRIM(MCSTYL)='BP' AND*/ TRIM(PDMCU)=TRIM(MCMCU)
LEFT JOIN PRODDTA.F7608B ON PDITM=TBITM AND TRIM(TBSHST)='SP' AND TRIM(ALADDS)=TRIM(TBADDS) AND TBBORI=PJBORI
left join proddta.f76b011 PIS  ON PIS.TDBNNF=FDBNNF AND PIS.TDN001=FDN001 AND PIS.TDUKID=FDUKID AND PIS.TDBRTX='05'
left join proddta.f76b011 COFINS  ON COFINS.TDBNNF=FDBNNF AND COFINS.TDN001=FDN001 AND COFINS.TDUKID=FDUKID AND COFINS.TDBRTX='06'
LEFT JOIN PRODDTA.F76B003 ON TRIM(PJBCFC)=TRIM(PUBCFC)
where 


 PDUORG >0
AND FDNXTR NOT IN ('996','998')
AND  FDDCT IN ('CT','NF')
AND PDDCTO !='OJ'





union ALL

--RECEBIDO








select 
DISTINCT
'RECEBIDO' TIPO_ENT,
TRIM(PDGLC) AS GL,
TRIM(GL.DRDL01) AS GL_DSC,
PDCO AS CIA,
TRIM(PDMCU) AS FILIAL,
TRIM(MCDL01) AS FILIAL2,
FDBNNF AS NF,
PDDOCO AS PEDIDO,
PDLOTN AS LOTE,
PDLNID/1000 PEDIDO_LINHA,
TO_CHAR('RECEBIDO '||TRIM(PDDCTO)) CATEGORIA,
TRIM(PDDCTO) AS TIPO,
CASE WHEN PDDRQJ>0 THEN  TO_DATE(TO_DATE((PDDRQJ+1900000), 'YYYYDDD'), 'DD/MM/RRRR')
ELSE TO_DATE(TO_DATE((1+1900000), 'YYYYDDD'), 'DD/MM/RRRR') END DATA_SOLICITACAO,
CASE WHEN PDPDDJ>0 THEN  TO_DATE(TO_DATE((PDPDDJ+1900000), 'YYYYDDD'), 'DD/MM/RRRR')
ELSE TO_DATE(TO_DATE((1+1900000), 'YYYYDDD'), 'DD/MM/RRRR') END ENTREGA_PROMETIDA,
CASE WHEN PRRCDJ>0 THEN TO_DATE(TO_DATE((PRRCDJ+1900000), 'YYYYDDD'), 'DD/MM/RRRR')
ELSE TO_DATE(TO_DATE((1+1900000), 'YYYYDDD'), 'DD/MM/RRRR')
 END RECEBIMENTO,
 CASE WHEN PRRCDJ>0 THEN  TO_DATE(TO_DATE((PRRCDJ+1900000), 'YYYYDDD'), 'DD/MM/RRRR')
ELSE TO_DATE(TO_DATE((1+1900000), 'YYYYDDD'), 'DD/MM/RRRR')
 END EMISSAO,


C.ABAN8 AS COD_FORNECEDOR,
TRIM(C.ABALPH) AS FORNECEDOR,
TRIM(PDLITM ) AS  COD,
TRIM(PDDSC1) AS DESCRICAO,
--TRIM(PDDSC2) AS DSC2 ,
TRIM(DF.DRDL01)||'('||trim(DF.DRKY)||')' as CLASSE_MERCADORIA,
TRIM(SB.DRDL01)||'('||trim(SB.DRKY)||')' as SUBCLASSE_MERCADORIA,
PDUORG/10000 AS QNT_SOLICITADA,
TRIM(PDUOM) AS UM,
PRUREC/10000 AS QTD_RECEBIDA,
PRUOM AS UM2,
PDPRRC/10000 AS PRECO_UNIT,
PDAEXP/100  PRECO_TOTAL,
PDFRRC/10000 UNITARIO_DOLAR,
PDFEA/100 TOTAL_DOLAR,

--PDAEXP/100 AS PRECO_TOTAL,
TRIM(PNPTD) AS COND_PAG,
PDLTTR AS ULT_STATUS,
PDNXTR AS PROX_STATUS,
TO_CHAR(TRIM(PDANI)) CONTA_CONTABIL,
FDBIPI/100 IPI,    
FDTXR2/100 IPI_PORC
,ALADDS
,PJBORI
,PJBCTF
,PJBCFC
,TO_CHAR(TRIM(GMDL01)) AS LEGENDA
,CASE
WHEN TRIM(PDPODC01)='B20' THEN 'ADMINISTRATIVO-operacao'
WHEN TRIM(PDPODC01)='B21' THEN 'ADMINISTRATIVO-Invest'
WHEN TRIM(PDPODC01)='B22' THEN 'ATIVO-operacao'
WHEN TRIM(PDPODC01)='B23' THEN 'ATIVO-INVEST'
WHEN TRIM(PDPODC01)='B24' THEN 'PRODUCAO-operacao'
WHEN TRIM(PDPODC01)='B25' THEN 'PRODUCAO-INVEST'
WHEN TRIM(PDPODC01)='B26' THEN 'SALARIO'
WHEN TRIM(PDPODC01)='B27' THEN 'ESTOQUE'
END LEGENDA2
,DPBRNOP
,FDBST1
--,PRUREC
,TO_CHAR(pdTORG) as ORIGINADOR
,A.IMSRP5 AS CAT_5
,NVL(FDTXR1/1000,0) ICMS
,TO_CHAR(PDCRCD) MOEDA
,
CASE 
WHEN PIS.TDBRTXA IS NULL THEN 'N'
WHEN PIS.TDBRTXA='0' THEN 'N'
WHEN PIS.TDBRTXA>0 THEN 'Y'
ELSE  TO_CHAR(PUBFPIS)
END  PIS,
trim(A.imdsc2) as DSC2,
TRIM(A.IMSEG1) AS SEG
,TRIM(COMP.ABALKY) COMPRADOR
,TRIM(NEG.ABALKY) NEGOCIADOR
, TRIM(IbABCS) CURVA_ABC
,IbLTLV LEAD
,TO_CHAR(FDUKID) UKID


,NVL(PIS.TDBRTXA/100,0) PIS_VALOR
,NVL(COFINS.TDBRTXA/100,0) COFINS_VALOR
,FDBICM/100 VALOR_ICMS

from PRODdta.f4311 
LEFT JOIN PRODDTA.F7611B C ON FDDOCO=PDDOCO AND PDCO=FDCO AND TRIM(PDLITM)=TRIM(FDLITM) AND FDPDCT=PDDCTO AND PDLNID=FDLNID AND FDNXTR NOT IN ('996','998')   AND FDNXTR NOT IN ('996','998') AND  FDDCT IN ('CT','NF')
LEFT JOIN PRODDTA.F7601B ON FDBNNF=FHBNNF AND FHN001=FDN001 AND FDDCT=FHDCT AND FHMCU=FDMCU AND FHCO=FDCO
left outer join PRODDTA.F43121  on PRDOCO = PDDOCO and PRDCTO = PDDCTO and PRMATC not in ('4','2') and trim(PRVINV) = trim(FDBNNF) and PRDOCO = FDDOCO and PRDCTO = FDPDCT and PRNLIN  = FDNLIN and  PRLNID = FDLNID --and f.pruclo <> '0'

Left Join PRODDTA.F4301  ON F4301.PHDOCO = F4311.PDDOCO
Left Join PRODDTA.F76432 ON F4311.PDDOCO  = F76432.PJDOCO AND F4311.PDLNID = F76432.PJLNID and F4311.Pdkcoo = F76432.PJkcoo
Left Join PRODDTA.F76B18 ON F76B18.FCBCLF = F76432.PJBCLF
Left Join PRODDTA.F7615B ON F7615B.TNBNOP = F76432.PJBNOP AND F7615B.TNBSOP = F76432.PJBSOP
INNER JOIN PRODDTA.F4101 A ON A.IMITM = PDITM
INNER JOIN PRODDTA.F0101 C ON PDAN8=C.ABAN8 
left join proddta.f4102 on ibitm=imitm and ibmcu=pdmcu
left join proddta.f0101 COMP ON COMP.ABAN8=IbBUYR
left join proddta.f0101 NEG ON NEG.ABAN8=IbCARP

LEFT JOIN PRODDTA.F0014 ON PNPTC=PDPTC 
LEFT JOIN PRODDTA.F0116 ON ALAN8=PDAN8
LEFT JOIN PRODDTA.F0901 ON GMCO=PDCO AND PDAID=GMAID
left outer join PRODCTL.F0005 DF    ON trim(DF.DRKY) = TRIM(A.IMPRP1) and DF.DRSY = '41' AND DF.DRRT = 'P1'
left outer join PRODCTL.F0005 SB    ON trim(SB.DRKY) = TRIM(A.IMPRP2) and SB.DRSY = '41' AND SB.DRRT = 'P2' 
left outer join PRODCTL.F0005 GL    ON trim(GL.DRKY) = TRIM(PDGLC) and GL.DRSY = '41' AND GL.DRRT = '9' 
LEFT JOIN PRODDTA.F76B200 ON F76432.PJBNOP=DPBNOP    AND F7615B.TNBSOP =DPBSOP 
LEFT JOIN PRODDTA.F0006 ON /*TRIM(MCSTYL)='BP' AND*/ TRIM(PDMCU)=TRIM(MCMCU)
LEFT JOIN PRODDTA.F7608B ON PDITM=TBITM AND TRIM(TBSHST)='SP' AND TRIM(ALADDS)=TRIM(TBADDS) AND TBBORI=PJBORI
left join proddta.f76b011 PIS  ON PIS.TDBNNF=FDBNNF AND PIS.TDN001=FDN001 AND PIS.TDUKID=FDUKID AND PIS.TDBRTX='05'
left join proddta.f76b011 COFINS  ON COFINS.TDBNNF=FDBNNF AND COFINS.TDN001=FDN001 AND COFINS.TDUKID=FDUKID AND COFINS.TDBRTX='06'
LEFT JOIN PRODDTA.F76B003 ON TRIM(PJBCFC)=TRIM(PUBCFC)
where 

 PDUORG >0

AND PDDCTO ='OJ'
AND PDLTTR NOT BETWEEN '980' AND '990' AND PDNXTR='999'
AND    TRIM(A.IMLITM) NOT LIKE 'PE0%'



UNION ALL


--DEVOLUÇÃO
select 
DISTINCT
'DEVOLUCAO' TIPO_ENT,
TRIM(SDGLC) AS GL,
TRIM(GL.DRDL01) AS GL_DSC,
SDCO AS CIA,
TRIM(SDMCU) AS FILIAL,
TRIM(MCDL01) AS FILIAL2,
FDBNNF AS NF,
SDDOCO AS PEDIDO,
FDLOTN AS LOTE,
SDLNID/1000 PEDIDO_LINHA,
to_char('DEVOLUÇÃO '||TRIM(sDDCTO))  CATEGORIA,
TRIM(SDDCTO) AS TIPO,
CASE WHEN SDDRQJ>0 THEN TO_DATE(TO_DATE((SDDRQJ+1900000), 'YYYYDDD'), 'DD/MM/RRRR')
ELSE TO_DATE(TO_DATE((1+1900000), 'YYYYDDD'), 'DD/MM/RRRR') END DATA_SOLICITACAO,
CASE WHEN SDPDDJ>0 THEN  TO_DATE(TO_DATE((SDPDDJ+1900000), 'YYYYDDD'), 'DD/MM/RRRR')
ELSE TO_DATE(TO_DATE((1+1900000), 'YYYYDDD'), 'DD/MM/RRRR') END ENTREGA_PROMETIDA,
CASE WHEN SDADDJ>0 THEN TO_DATE(TO_DATE((SDADDJ+1900000), 'YYYYDDD'), 'DD/MM/RRRR')
ELSE TO_DATE(TO_DATE((1+1900000), 'YYYYDDD'), 'DD/MM/RRRR') END RECEBIMENTO,
TO_DATE(TO_DATE((1+1900000), 'YYYYDDD'), 'DD/MM/RRRR') EMISSAO,
C.ABAN8 AS COD_FORNECEDOR,
TRIM(C.ABALPH) AS FORNECEDOR,
TRIM(SDLITM ) AS  COD,
TRIM(SDDSC1) AS DESCRICAO,
--TRIM(PDDSC2) AS DSC2 ,
TRIM(DF.DRDL01)||'('||trim(DF.DRKY)||')' as CLASSE_MERCADORIA,
TRIM(SB.DRDL01)||'('||trim(SB.DRKY)||')' as SUBCLASSE_MERCADORIA,
-SDSQOR/10000 AS QNT_SOLICITADA,
TRIM(SDUOM2) AS UM,
-SDSQOR/10000 AS QTD_RECEBIDA,
SDUOM2 AS UM2,
-FDUPRC/10000 AS PRECO_UNIT,
-FDAEXP/100  PRECO_TOTAL,
-FDUPRC/10000 UNITARIO_DOLAR,
-FDAEXP/100 TOTAL_DOLAR,
--PDAEXP/100 AS PRECO_TOTAL,
TRIM(PNPTD) AS COND_PAG,
SDLTTR AS ULT_STATUS,
SDNXTR AS PROX_STATUS,
'' CONTA_CONTABIL,
FDBIPI/100 IPI,    
FDTXR2/100 IPI_PORC
,ALADDS
,SJBORI
,SJBCTF
,SJBCFC
,'DEVOLUÇÃO DE VENDA' AS LEGENDA
,'DEVOLUÇÃO'  LEGENDA2
,DPBRNOP
,FDBST1

,'' ORIGINADOR
,A.IMSRP5 AS CAT_5
,NVL(FDTXR1/1000,0) ICMS
,'BRL' MOEDA

,CASE 
WHEN PIS.TDBRTXA IS NULL THEN 'N'
WHEN PIS.TDBRTXA='0' THEN 'N'
WHEN PIS.TDBRTXA>0 THEN 'Y'
ELSE  TO_CHAR(PUBFPIS)
END  PIS,
trim(A.imdsc2) as DSC2,
TRIM(A.IMSEG1) AS SEG
,TRIM(COMP.ABALKY) COMPRADOR
,TRIM(NEG.ABALKY) NEGOCIADOR
, TRIM(IbABCS) CURVA_ABC
,IbLTLV LEAD,
'' UKID
,NVL(PIS.TDBRTXA/100,0) PIS_VALOR
,NVL(COFINS.TDBRTXA/100,0) COFINS_VALOR
,FDBICM/100 VALOR_ICMS
 FROM
PRODDTA.F4211 
LEFT JOIN PRODDTA.F0116 ON ALAN8=SDAN8
LEFT JOIN PRODDTA.F7611B ON FDCO=SDCO AND SDDOCO=FDDOCO AND FDPDCT=SDDCTO AND FDMCU=SDMCU AND FDLNID=SDLNID AND FDNXTR NOT IN ('996','998')  
INNER JOIN PRODDTA.F0101 C ON SDAN8=C.ABAN8 
INNER JOIN PRODDTA.F4101 A ON A.IMITM = SDITM
left join proddta.f4102 on ibitm=imitm and ibmcu=sdmcu
left join proddta.f0101 COMP ON COMP.ABAN8=IbBUYR
left join proddta.f0101 NEG ON NEG.ABAN8=IbCARP

left outer join PRODCTL.F0005 DF    ON trim(DF.DRKY) = TRIM(A.IMPRP1) and DF.DRSY = '41' AND DF.DRRT = 'P1'
left outer join PRODCTL.F0005 SB    ON trim(SB.DRKY) = TRIM(A.IMPRP2) and SB.DRSY = '41' AND SB.DRRT = 'P2' 
left outer join PRODCTL.F0005 GL    ON trim(GL.DRKY) = TRIM(SDGLC) and GL.DRSY = '41' AND GL.DRRT = '9' 

LEFT JOIN PRODDTA.F0014 ON PNPTC=SDPTC 
LEFT JOIN PRODDTA.F76422 ON SJDOCO=SDDOCO AND SJDCTO=SDDCTO AND SJKCOO=SDCO AND SJLNID=SDLNID 

Left Join PRODDTA.F76B18 ON F76B18.FCBCLF = SJBCLF
Left Join PRODDTA.F7615B ON F7615B.TNBNOP = SJBNOP AND F7615B.TNBSOP = SJBSOP
LEFT JOIN PRODDTA.F76B200 ON SJBNOP=DPBNOP    AND F7615B.TNBSOP =DPBSOP 
LEFT JOIN PRODDTA.F7608B ON SDITM=TBITM AND TRIM(TBSHST)='SP' AND TRIM(ALADDS)=TRIM(TBADDS) AND TBBORI=SJBORI
LEFT JOIN PRODDTA.F0006 ON /*TRIM(MCSTYL)='BP' AND*/ TRIM(SDMCU)=TRIM(MCMCU)

left join proddta.f76b011 PIS  ON PIS.TDBNNF=FDBNNF AND PIS.TDN001=FDN001 AND PIS.TDUKID=FDUKID AND PIS.TDBRTX='05'
left join proddta.f76b011 COFINS  ON COFINS.TDBNNF=FDBNNF AND COFINS.TDN001=FDN001 AND COFINS.TDUKID=FDUKID AND PIS.TDBRTX='06'
LEFT JOIN PRODDTA.F76B003 ON TRIM(SJBCFC)=TRIM(PUBCFC)

where  
 SDDCTO IN ('DZ','DY','D9')
AND SDUORG >0
AND SDLTTR !='980'






), CP AS (


select 
DISTINCT
rpco,
rpdct,
rpdoc rpdocc,
rpDIVJ ,
rpdoc ,
CASE
WHEN pnnsp IS NOT NULL THEN pnnsp
ELSE SUM(1)
END  QTD_PARCELAS,
MAX(  to_date((RPDDJ + 1900000), 'YYYYDDD')-  to_date((RPDIVJ + 1900000), 'YYYYDDD')) MAXIMO,
MAX(  to_date((RPDDJ + 1900000), 'YYYYDDD')-  to_date((RPDIVJ + 1900000), 'YYYYDDD')) /(CASE WHEN pnnsp IS NOT NULL THEN pnnsp ELSE SUM(1) END ) MEDIA


FROM PRODDTA.F0411
LEFT JOIN  proddta.f0014 ON RPPTC=pnptc AND PNNDTP>'0' AND PNDTPA>'0' AND pnnsp>'0'
where   rpdct='PV'
and rpDGJ>'122001'
and rpDDJ>'122001'
AND RPSFXE!='1'
AND RPCO !='51000'
--AND  RPATXN>0
AND RPDOC||RPSFX!='231476002'

GROUP BY rpco,rpdct,rpdoc ,rpDIVJ ,rpdoc ,pnnsp



),MAX_CP AS(
select 
(A.PRDOCO) PEDIDOM,
(A.PRLNID/1000) LINHAM,
A.PRDCTO TIPOM,
TO_CHAR(A.PRAN8) AN8M,
A.PRCO CIAM,
TRIM(A.PRLITM) CODM,
MAX(CASE WHEN MEDIA<0 THEN 1 ELSE  ROUND(MEDIA,2) END) MEDIAM


from  PRODDTA.F43121 A
INNER JOIN PRODDTA.F43121 B ON A.PRDOCO=B.PRDOCO AND B.PRMATC='1' AND A.PRNLIN=B.PRNLIN AND A.PRLNID=B.PRLNID AND A.PRITM=B.PRITM AND A.PRSFXO=B.PRSFXO AND A.PRDCTO=B.PRDCTO AND A.PRKCOO=B.PRKCOO AND A.PRAN8=B.PRAN8
inner JOIN CP ON RPCO=A.PRCO AND RPDOC=A.PRDOC AND RPDCT=A.PRDCT 

where 
 A.PRDCT='PV' AND A.PRMATC='2'

 and rpDIVJ>'122001'
 and A.PRUPMJ>'122001'
  and TRIM(a.PRNXTR) IS NOT  NULL 
--AND A.PRDOCO='484543'
--  AND RPDOC='110055'
GROUP BY (A.PRDOCO) ,
(A.PRLNID/1000) ,
A.PRDCTO ,
TO_CHAR(A.PRAN8) ,
A.PRCO ,
TRIM(A.PRLITM) 

)







SELECT



						AA.EMISSAO,
AA.DSC2,
AA.SEG,
						AA.CLASSE_MERCADORIA,
AA.SUBCLASSE_MERCADORIA,
                        AA.GL,
                        AA.GL_DSC,
                        CASE 
                        WHEN TRIM(ABALPH) IS NULL THEN TO_CHAR(AA.ORIGINADOR) ELSE 
                        TO_CHAR(TRIM(ABALPH) ) END  ORIGINADOR,
						AA.CAT_5,
                        AA.CIA,
                       AA.FILIAL,
                       AA.FILIAL2,
                        AA.NF,
                      AA.DPBRNOP,

                        AA.PEDIDO,
                        AA.LOTE,
                        AA.PEDIDO_LINHA,
                        AA.CATEGORIA CATEGORIA_PED,
                        AA.TIPO,
                        AA.DATA_SOLICITACAO,
                        AA.ENTREGA_PROMETIDA,
                        AA.RECEBIMENTO,
                          CASE 
                         WHEN  substr(AA.CATEGORIA,1,9) ='RECEBIDO '  THEN AA.RECEBIMENTO
                           WHEN  substr(AA.CATEGORIA,1,9) ='RECEBIDO ' THEN AA.RECEBIMENTO
                          when substr(AA.CATEGORIA,1,9)='DEVOLUÇÃO' THEN AA.RECEBIMENTO
                        WHEN  substr(AA.CATEGORIA,1,9) ='A RECEBER'   AND  AA.ENTREGA_PROMETIDA < to_date(SYSDATE,'DD/MM/RRRR')  THEN   to_date(SYSDATE,'DD/MM/RRRR')
                        ELSE   AA.ENTREGA_PROMETIDA


                          END DATA_RECEBIMENTO,



                        AA.COD_FORNECEDOR,
                        AA.FORNECEDOR,
                        AA.COD,
                        AA.DESCRICAO,

                        CASE WHEN (AA.CLASSE_MERCADORIA LIKE ('%FLUIDOS%') AND AA.SUBCLASSE_MERCADORIA LIKE ('%REATIVO OH%') AND TRIM(AA.COD) NOT IN ('AES0129.0003','AES0119.0003','AES0106.0001')) OR
                                  (AA.CLASSE_MERCADORIA LIKE ('%FLUIDOS%') AND AA.SUBCLASSE_MERCADORIA LIKE ('%LUBRIFICANTES%') AND TRIM(AA.COD) NOT IN ('AES0129.0003','AES0119.0003','AES0106.0001')) OR
                                  (AA.CLASSE_MERCADORIA LIKE ('%RIA-PRIMA%') AND AA.SUBCLASSE_MERCADORIA LIKE ('%SILICAS%') AND TRIM(AA.COD) NOT IN ('AES0129.0003','AES0119.0003','AES0106.0001')) OR
                                  (AA.CLASSE_MERCADORIA LIKE ('%RIA-PRIMA%') AND AA.SUBCLASSE_MERCADORIA LIKE ('%SILICAS%')  AND TRIM(AA.COD) NOT IN ('AES0129.0003','AES0119.0003','AES0106.0001')) THEN 'SILICONES'

                             WHEN (AA.CLASSE_MERCADORIA LIKE ('%RIA-PRIMA%') AND AA.SUBCLASSE_MERCADORIA LIKE ('%PLASTIFICANTES%')  AND TRIM(AA.COD) NOT IN ('AES0129.0003','AES0119.0003','AES0106.0001')) OR
                                  (AA.CLASSE_MERCADORIA LIKE ('%HIBRIDOS-PRIMA%') AND AA.SUBCLASSE_MERCADORIA LIKE ('%POLIMEROS%')  AND TRIM(AA.COD) NOT IN ('AES0129.0003','AES0119.0003','AES0106.0001')) OR
                                  (TRIM(AA.COD) IN ('AES0129.0003')) OR
                                  (TRIM(AA.COD) IN ('AES0119.0003')) THEN 'HIBRIDOS'

                            WHEN (TRIM(AA.COD) IN ('AES0119.0003')) OR
                                 (TRIM(AA.COD) IN ('AES0102.0001','AES0115.0001','AES0116.0002','AES0116.0003','AES0118.0001','AES0119.0001','AES0128.0001','AES0128.0002','AES0129.0001'))  THEN 'ACRILICOS'

                                 ELSE 'DIVERSOS'
                                  END CATEGORIA,
                        CASE   --SILICONE
                             WHEN AA.CLASSE_MERCADORIA LIKE ('%FLUIDOS%') AND AA.SUBCLASSE_MERCADORIA LIKE ('%REATIVO OH%') AND TRIM(AA.COD) NOT IN ('AES0129.0003','AES0119.0003','AES0106.0001')     THEN 'OH'
                             WHEN AA.CLASSE_MERCADORIA LIKE ('%FLUIDOS%') AND AA.SUBCLASSE_MERCADORIA LIKE ('%LUBRIFICANTES%') AND TRIM(AA.COD) NOT IN ('AES0129.0003','AES0119.0003','AES0106.0001')     THEN 'FLUIDOS' 
                             WHEN AA.CLASSE_MERCADORIA LIKE ('%RIA-PRIMA%') AND AA.SUBCLASSE_MERCADORIA LIKE ('%SILICAS%') AND TRIM(AA.COD) NOT IN ('AES0129.0003','AES0119.0003','AES0106.0001')  THEN 'SILICA' 
                             WHEN AA.CLASSE_MERCADORIA LIKE ('%RIA-PRIMA%') AND AA.SUBCLASSE_MERCADORIA LIKE ('%SOLVENTE%')  AND TRIM(AA.COD) NOT IN ('AES0129.0003','AES0119.0003','AES0106.0001') THEN 'SOLVENTES'
                               --H?BRIDOS
                            WHEN AA.CLASSE_MERCADORIA LIKE ('%RIA-PRIMA%') AND AA.SUBCLASSE_MERCADORIA LIKE ('%PLASTIFICANTES%')  AND TRIM(AA.COD) NOT IN ('AES0129.0003','AES0119.0003','AES0106.0001') THEN 'PLASTIFICANTES'   
                            WHEN AA.CLASSE_MERCADORIA LIKE ('%HIBRIDOS-PRIMA%') AND AA.SUBCLASSE_MERCADORIA LIKE ('%-POLIMEROS%')  AND TRIM(AA.COD) NOT IN ('AES0129.0003','AES0119.0003','AES0106.0001') THEN 'PRO-POLIMEROS'   
                            WHEN TRIM(AA.COD) IN ('AES0129.0003') THEN 'PROTETOR UV'
                            WHEN TRIM(AA.COD) IN ('AES0119.0003') THEN 'AGENTE REOLOGICO'
                               --ACR?LICOS
                            WHEN TRIM(AA.COD) IN ('AES0119.0003','AES0106.0001') THEN 'RESINA' 
                            WHEN TRIM(AA.COD) IN ('AES0102.0001','AES0115.0002','AES0115.0001','AES0116.0002','AES0116.0003','AES0118.0001','AES0119.0001','AES0128.0001','AES0128.0002','AES0129.0001') THEN 'OUTROS - ACRILICOS' 
                               --DIVERSOS
                            WHEN AA.CLASSE_MERCADORIA LIKE ('%SILANOS%') AND TRIM(AA.COD) NOT IN ('AES0129.0003','AES0119.0003','AES0106.0001') THEN 'SILANOS'   
                            WHEN AA.CLASSE_MERCADORIA LIKE ('%RIA-PRIMA%') AND AA.SUBCLASSE_MERCADORIA LIKE ('%CARGAS MINERAIS%') AND TRIM(AA.COD) NOT IN ('AES0129.0003','AES0119.0003','AES0106.0001') THEN 'CARGAS MINERAIS' 
                            WHEN AA.CLASSE_MERCADORIA LIKE ('%RIA-PRIMA%') AND AA.SUBCLASSE_MERCADORIA LIKE ('%PIGMENTOS/CORANTES%') AND TRIM(AA.COD) NOT IN ('AES0129.0003','AES0119.0003','AES0106.0001') THEN 'PIGMENTOS' 
                            WHEN AA.CLASSE_MERCADORIA LIKE ('%RIA-PRIMA%') AND AA.SUBCLASSE_MERCADORIA LIKE ('%POLIMEROS/INJECAO%') AND TRIM(AA.COD) NOT IN ('AES0129.0003','AES0119.0003','AES0106.0001') THEN 'POLIETILENO'
                            WHEN AA.CLASSE_MERCADORIA LIKE ('%EMBALAGENS%') AND AA.SUBCLASSE_MERCADORIA LIKE ('%CAIXA%') AND TRIM(AA.COD) NOT IN ('AES0129.0003','AES0119.0003','AES0106.0001') THEN 'CAIXA'
                            WHEN AA.CLASSE_MERCADORIA LIKE ('%EMBALAGENS%') AND AA.SUBCLASSE_MERCADORIA LIKE ('%SLEEVE%') AND TRIM(AA.COD) NOT IN ('AES0129.0003','AES0119.0003','AES0106.0001') THEN 'SLEEVE'
                            WHEN AA.CLASSE_MERCADORIA LIKE ('%EMBALAGENS%') AND AA.SUBCLASSE_MERCADORIA LIKE ('%BISNAGA DE ALUMINIO%') AND TRIM(AA.COD) NOT IN ('AES0129.0003','AES0119.0003','AES0106.0001') THEN 'BISNAGA ALUMINIO'
                            WHEN AA.CLASSE_MERCADORIA LIKE ('%EMBALAGENS%') AND AA.SUBCLASSE_MERCADORIA LIKE ('%BISNAGA PLASTICA%') AND TRIM(AA.COD) NOT IN ('AES0129.0003','AES0119.0003','AES0106.0001') THEN 'BISNAGA PLASTICA'
                            WHEN AA.CLASSE_MERCADORIA LIKE ('%RIA-PRIMA%') AND AA.SUBCLASSE_MERCADORIA LIKE ('%OLEOS MINERAIS%') AND TRIM(AA.COD) NOT IN ('AES0129.0003','AES0119.0003','AES0106.0001') THEN 'OLEO MINERAL'
                            ELSE 'OUTROS'  

                        END SUB_CATEGORIA,
                        --AA.CLASSE_MERCADORIA AAA,



                        --AA.CLASSE_MERCADORIA,
                        --AA.SUBCLASSE_MERCADORIA,
                        AA.QNT_SOLICITADA QTD_SOLICITADA,
                        AA.UM,
                        AA.QTD_RECEBIDA,
                        AA.UM2,
                        AA.PRECO_UNIT,
                        AA.PRECO_TOTAL,
AA.UNITARIO_DOLAR,
AA.TOTAL_DOLAR,
                        AA.PJBORI as ORIGEM,
                        TRIM(AA.ALADDS)||'-'||AA.PJBCFC||'-'||AA.PJBCTF  AS UF_USO_ST,



ROUND((AA.VALOR_ICMS),2) ICMS,


/*
CASE 

WHEN AA.PIS='Y' THEN  ROUND((AA.PRECO_UNIT * (1-(0.0925+ICMS/100)) ),2)
WHEN AA.PIS='N' THEN  ROUND((AA.PRECO_UNIT * (1-(ICMS/100)) ),2)
END UNIT_NET,     

CASE 
WHEN AA.PIS='Y' THEN  ROUND((AA.PRECO_TOTAL * (1-(0.0925+ICMS/100)) ),2)
WHEN AA.PIS='N' THEN  ROUND((AA.PRECO_TOTAL * (1-(ICMS/100)) ),2)
END TOTAL_NET, 
*/


ROUND(  (AA.PRECO_TOTAL-(PIS_VALOR+COFINS_VALOR+(ROUND((AA.VALOR_ICMS),2))) )   /(case when nvl(AA.QNT_SOLICITADA,0)!=0 then  AA.QNT_SOLICITADA    when nvl(AA.QTD_RECEBIDA,0)!=0 then  AA.QTD_RECEBIDA   else 1 end),2)    UNIT_NET, 

ROUND(AA.PRECO_TOTAL-(PIS_VALOR+COFINS_VALOR+(ROUND((AA.VALOR_ICMS),2)))  ,2) TOTAL_NET, 


        CASE 
						WHEN AA.PIS='Y'  THEN  COFINS_VALOR--ROUND((AA.PRECO_TOTAL * 0.076),4)
						ELSE 0 
                        END COFINS,



						 CASE 
						WHEN AA.PIS='Y' THEN  PIS_VALOR--ROUND((AA.PRECO_TOTAL * 0.0165),4)
						ELSE 0 
                        END PIS,




                        AA.COND_PAG,
                        AA.ULT_STATUS,
                        AA.PROX_STATUS,
                        AA.CONTA_CONTABIL,
                        AA.IPI,
                        AA.IPI_PORC,
                        AA.ALADDS,
                        AA.PJBORI,
             AA.MOEDA,
			 AA.COMPRADOR,
AA.NEGOCIADOR,
AA.CURVA_ABC,
AA.LEAD,

CASE 
WHEN AA.COND_PAG='07/14' THEN 10.5
WHEN AA.COND_PAG='7/14' THEN 10.5
WHEN AA.COND_PAG='10/20' THEN 15
WHEN AA.COND_PAG='0/15' THEN 7.5
WHEN AA.COND_PAG='0/30/60' THEN 30
WHEN AA.COND_PAG='03 DDL' THEN 3
WHEN AA.COND_PAG='07 DDL' THEN 7
WHEN AA.COND_PAG='07/14/21' THEN 14
WHEN AA.COND_PAG='07/14/21/28' THEN 17.5
WHEN AA.COND_PAG='10 DDL' THEN 10
WHEN AA.COND_PAG='10/20/30/40/50/60/70/80/90' THEN 50
WHEN AA.COND_PAG='100DDL Pagto Terça-Feira' THEN 100
WHEN AA.COND_PAG='103/108/113' THEN 108
WHEN AA.COND_PAG='110 DDL' THEN 110
WHEN AA.COND_PAG='110/120/130' THEN 120
WHEN AA.COND_PAG='12 DDL' THEN 12
WHEN AA.COND_PAG='120 DDL' THEN 120
WHEN AA.COND_PAG='120 DDL - Pagto 05 e 20' THEN 120
WHEN AA.COND_PAG='14 DDL' THEN 14
WHEN AA.COND_PAG='14/21' THEN 17.5
WHEN AA.COND_PAG='14/21/28' THEN 21
WHEN AA.COND_PAG='14/21/28/35' THEN 24.5
WHEN AA.COND_PAG='14/21/28/35/42/49            ' THEN 28
WHEN AA.COND_PAG='14/21/28/35/42/49/56' THEN 35
WHEN AA.COND_PAG='14/28' THEN 21
WHEN AA.COND_PAG='15 DDL' THEN 15
WHEN AA.COND_PAG='15/20/30/35                  ' THEN 25
WHEN AA.COND_PAG='15/21/28/35' THEN 24.75
WHEN AA.COND_PAG='15/25                        ' THEN 15
WHEN AA.COND_PAG='15/30' THEN 22.5
WHEN AA.COND_PAG='15/30/45                     ' THEN 30
WHEN AA.COND_PAG='15/30/45/60                  ' THEN 37.5
WHEN AA.COND_PAG='15/30/45/60/75' THEN 45
WHEN AA.COND_PAG='18/25/32/39/43' THEN 31.4
WHEN AA.COND_PAG='180 DDL' THEN 180
WHEN AA.COND_PAG='2 DDL' THEN 2
WHEN AA.COND_PAG='20 DDL Pagto 3a 4a 5a 6a' THEN 20
WHEN AA.COND_PAG='20/30/40' THEN 30
WHEN AA.COND_PAG='20/30/40/50/60' THEN 40
WHEN AA.COND_PAG='20/40' THEN 30
WHEN AA.COND_PAG='20/40/60' THEN 40
WHEN AA.COND_PAG='20/40/60/80' THEN 50
WHEN AA.COND_PAG='21 DDL' THEN 21
WHEN AA.COND_PAG='21/28' THEN 24.5
WHEN AA.COND_PAG='21/28/35' THEN 28
WHEN AA.COND_PAG='21/28/35/42' THEN 31.5
WHEN AA.COND_PAG='21/28/35/42/49' THEN 35
WHEN AA.COND_PAG='21/28/35/42/49/56' THEN 38.5
WHEN AA.COND_PAG='21/28/35/42/49/56/63' THEN 42
WHEN AA.COND_PAG='21/28/35/42/49/56/63/70' THEN 45.5
WHEN AA.COND_PAG='21/28/35/42/49/56/63/70/77/84' THEN 52.5
WHEN AA.COND_PAG='21/35/42' THEN 32.66666667
WHEN AA.COND_PAG='21/42                        ' THEN 31.5
WHEN AA.COND_PAG='21/42/56' THEN 39.66666667
WHEN AA.COND_PAG='23/46' THEN 34.5
WHEN AA.COND_PAG='24/31/38/45                  ' THEN 34.5
WHEN AA.COND_PAG='24/34/44/54/64/74' THEN 49
WHEN AA.COND_PAG='25 DDL' THEN 25
WHEN AA.COND_PAG='25/35/42                     ' THEN 35
WHEN AA.COND_PAG='27/34' THEN 30.5
WHEN AA.COND_PAG='270 DDL' THEN 270
WHEN AA.COND_PAG='28 DDL' THEN 28
WHEN AA.COND_PAG='28 DDL Pagto 01 e 16' THEN 28
WHEN AA.COND_PAG='28 DDL Pagto Quarta-feira' THEN 28
WHEN AA.COND_PAG='28/35' THEN 31.5
WHEN AA.COND_PAG='28/35/42' THEN 35
WHEN AA.COND_PAG='28/35/42 Pgto Quarta Feira' THEN 35
WHEN AA.COND_PAG='28/35/42/49' THEN 38.5
WHEN AA.COND_PAG='28/35/42/49 Pgto Qua-Sex' THEN 38.5
WHEN AA.COND_PAG='28/35/42/49/56' THEN 42
WHEN AA.COND_PAG='28/35/42/49/56/62/69         ' THEN 49
WHEN AA.COND_PAG='28/35/42/49/56/62/69/75/82/89' THEN 58.7
WHEN AA.COND_PAG='28/35/42/49/56/63' THEN 45.5
WHEN AA.COND_PAG='28/35/42/49/56/63 SEXTA' THEN 45.5
WHEN AA.COND_PAG='28/35/42/49/56/63/70' THEN 49
WHEN AA.COND_PAG='28/35/42/49/56/63/70 Quarta' THEN 49
WHEN AA.COND_PAG='28/35/42/49/56/63/70 ' THEN 45.5
WHEN AA.COND_PAG='28/35/42/49/56/63/70/77' THEN 52.5
WHEN AA.COND_PAG='28/35/42/49/56/63/70/77/84 ' THEN 52.5
WHEN AA.COND_PAG='28/35/42/49/56/63/70/77/84/91' THEN 59.5
WHEN AA.COND_PAG='28/35/42/49/57' THEN 42.2
WHEN AA.COND_PAG='28/35/42/49/60' THEN 42.8
WHEN AA.COND_PAG='28/35/42/49/65' THEN 43.8
WHEN AA.COND_PAG='28/35/42/50 ' THEN 35
WHEN AA.COND_PAG='28/35/42/56' THEN 40.25
WHEN AA.COND_PAG='28/35/42/56/63' THEN 44.8
WHEN AA.COND_PAG='28/38' THEN 33
WHEN AA.COND_PAG='28/42' THEN 35
WHEN AA.COND_PAG='28/42/56' THEN 42
WHEN AA.COND_PAG='28/42/56' THEN 42
WHEN AA.COND_PAG='28/42/56/63/70' THEN 56
WHEN AA.COND_PAG='28/42/56/70' THEN 49
WHEN AA.COND_PAG='28/42/56/70/84' THEN 56
WHEN AA.COND_PAG='28/42/56/70/84/98' THEN 63
WHEN AA.COND_PAG='28/42/56/70/84/98/112        ' THEN 70
WHEN AA.COND_PAG='28/42/56/77/91' THEN 58.8
WHEN AA.COND_PAG='28/42/70/84' THEN 46.66666667
WHEN AA.COND_PAG='28/45' THEN 36.5
WHEN AA.COND_PAG='28/45/62' THEN 36.5
WHEN AA.COND_PAG='28/56' THEN 42
WHEN AA.COND_PAG='28/56 Pagto Ter-Quin' THEN 42
WHEN AA.COND_PAG='28/56/84' THEN 56
WHEN AA.COND_PAG='28/56/84 ' THEN 42
WHEN AA.COND_PAG='28/56/84/112' THEN 70
WHEN AA.COND_PAG='29 DDL' THEN 29
WHEN AA.COND_PAG='30 DDL' THEN 30
WHEN AA.COND_PAG='30 DDL TER QUA QUI SEX' THEN 30
WHEN AA.COND_PAG='30/35/40/45/50/55/60' THEN 45
WHEN AA.COND_PAG='30/35/40/45/50/55/60/65/70/75' THEN 52.5
WHEN AA.COND_PAG='30/37/45/52/60               ' THEN 41
WHEN AA.COND_PAG='30/38/45/52/60' THEN 45
WHEN AA.COND_PAG='30/38/45/60' THEN 43.25
WHEN AA.COND_PAG='30/40                        ' THEN 35
WHEN AA.COND_PAG='30/40/50' THEN 40
WHEN AA.COND_PAG='30/40/50/60' THEN 45
WHEN AA.COND_PAG='30/40/50/60/70' THEN 50
WHEN AA.COND_PAG='30/40/50/60/70/80/90' THEN 60
WHEN AA.COND_PAG='30/40/50/65/70/85/106/116/126' THEN 76.44444444
WHEN AA.COND_PAG='30/42' THEN 36
WHEN AA.COND_PAG='30/45' THEN 37.5
WHEN AA.COND_PAG='30/45/60' THEN 45
WHEN AA.COND_PAG='30/45/60 Pagto Ter-Quin' THEN 45
WHEN AA.COND_PAG='30/45/60/75' THEN 52.5
WHEN AA.COND_PAG='30/45/60/75/90' THEN 60
WHEN AA.COND_PAG='30/45/60/75/90 TER - QUIN' THEN 60
WHEN AA.COND_PAG='30/45/60/75/90/105' THEN 67.5
WHEN AA.COND_PAG='30/52/70' THEN 50.66666667
WHEN AA.COND_PAG='30/60' THEN 45
WHEN AA.COND_PAG='30/60 Pagto dia 10 e 25' THEN 45
WHEN AA.COND_PAG='30/60/90' THEN 60
WHEN AA.COND_PAG='30/60/90 Ter - Quin' THEN 60
WHEN AA.COND_PAG='30/60/90/120' THEN 75
WHEN AA.COND_PAG='30/60/90/120/150' THEN 90
WHEN AA.COND_PAG='31 DDL' THEN 31
WHEN AA.COND_PAG='33 DDL' THEN 33
WHEN AA.COND_PAG='34 DDL' THEN 34
WHEN AA.COND_PAG='35 DDL' THEN 35
WHEN AA.COND_PAG='35/40/45' THEN 37.5
WHEN AA.COND_PAG='35/42' THEN 38.5
WHEN AA.COND_PAG='35/42/49' THEN 42
WHEN AA.COND_PAG='35/42/49/56' THEN 45.5
WHEN AA.COND_PAG='35/42/49/56/63' THEN 49
WHEN AA.COND_PAG='35/42/49/56/63 Pagto Quinta' THEN 49
WHEN AA.COND_PAG='35/42/49/56/63/70' THEN 52.5
WHEN AA.COND_PAG='35/42/49/56/63/70/77' THEN 56
WHEN AA.COND_PAG='35/42/49/56/63/70/77/84' THEN 59.5
WHEN AA.COND_PAG='35/42/49/56/63/70/77/84/91' THEN 63
WHEN AA.COND_PAG='35/42/49/56/63/70/77/84/91/98' THEN 66.5
WHEN AA.COND_PAG='35/42/49/56/63/70/77/85' THEN 59.625
WHEN AA.COND_PAG='35/42/50' THEN 42.333333
WHEN AA.COND_PAG='35/42/56' THEN 42
WHEN AA.COND_PAG='35/45' THEN 40
WHEN AA.COND_PAG='35/45/52' THEN 44
WHEN AA.COND_PAG='35/45/52/60' THEN 48
WHEN AA.COND_PAG='35/45/55' THEN 45
WHEN AA.COND_PAG='35/45/55 - 10/20/30' THEN 45
WHEN AA.COND_PAG='35/45/55/65 - 10/20/30' THEN 50
WHEN AA.COND_PAG='35/45/55/65/75' THEN 55
WHEN AA.COND_PAG='35/45/55/65/75 - 07/17/27' THEN 55
WHEN AA.COND_PAG='35/45/60' THEN 45
WHEN AA.COND_PAG='35/47/59/71/83/95/107/119/131' THEN 83
WHEN AA.COND_PAG='35/49/56/63/70/77/84' THEN 62
WHEN AA.COND_PAG='35/49/60' THEN 48
WHEN AA.COND_PAG='35/49/63                     ' THEN 49
WHEN AA.COND_PAG='35/49/63/77/91' THEN 63
WHEN AA.COND_PAG='35/50' THEN 42.5
WHEN AA.COND_PAG='35/50/65/75' THEN 56.25
WHEN AA.COND_PAG='35/55/75' THEN 55
WHEN AA.COND_PAG='35/56/77' THEN 56
WHEN AA.COND_PAG='35/63' THEN 49
WHEN AA.COND_PAG='35/63/91' THEN 63
WHEN AA.COND_PAG='37 DDL' THEN 37
WHEN AA.COND_PAG='38 DDL' THEN 38
WHEN AA.COND_PAG='38/45/52' THEN 45
WHEN AA.COND_PAG='39/59/79' THEN 59
WHEN AA.COND_PAG='40 DDL' THEN 40
WHEN AA.COND_PAG='40/50/60' THEN 50
WHEN AA.COND_PAG='40/50/60/70/80' THEN 60
WHEN AA.COND_PAG='40/50/60/70/80/90' THEN 65
WHEN AA.COND_PAG='40/50/60/70/80/90/100' THEN 70
WHEN AA.COND_PAG='40/60/75' THEN 60
WHEN AA.COND_PAG='41 DDL' THEN 41
WHEN AA.COND_PAG='42 DDL' THEN 42
WHEN AA.COND_PAG='42/49' THEN 45.5
WHEN AA.COND_PAG='42/49/56' THEN 49
WHEN AA.COND_PAG='42/49/56/63' THEN 52.5
WHEN AA.COND_PAG='42/49/56/63/70' THEN 56
WHEN AA.COND_PAG='42/49/56/63/70/77' THEN 59.5
WHEN AA.COND_PAG='42/49/56/63/70/77/84' THEN 59.5
WHEN AA.COND_PAG='42/49/56/63/70/77/84/91' THEN 66.5
WHEN AA.COND_PAG='42/56' THEN 49
WHEN AA.COND_PAG='42/56/65' THEN 54.33333333
WHEN AA.COND_PAG='42/56/70' THEN 56
WHEN AA.COND_PAG='42/56/70/84/98' THEN 70
WHEN AA.COND_PAG='42/56/70/84/98/112' THEN 77
WHEN AA.COND_PAG='42/70/98' THEN 70
WHEN AA.COND_PAG='43 DDL' THEN 43
WHEN AA.COND_PAG='44 DDL' THEN 44
WHEN AA.COND_PAG='45 DDL' THEN 45
WHEN AA.COND_PAG='45/50/55/60/65/70/75/80/85' THEN 62.5
WHEN AA.COND_PAG='45/52' THEN 48.5
WHEN AA.COND_PAG='45/52/59' THEN 52
WHEN AA.COND_PAG='45/52/59/66/73/80' THEN 59
WHEN AA.COND_PAG='45/52/60' THEN 52.33333333
WHEN AA.COND_PAG='45/53' THEN 49
WHEN AA.COND_PAG='45/55/65' THEN 55
WHEN AA.COND_PAG='45/55/65/75' THEN 55
WHEN AA.COND_PAG='45/60' THEN 52.5
WHEN AA.COND_PAG='45/60/75' THEN 60
WHEN AA.COND_PAG='45/60/75/90' THEN 67.5
WHEN AA.COND_PAG='45/60/75/90/105' THEN 67.5
WHEN AA.COND_PAG='45/60/75/90/115' THEN 77
WHEN AA.COND_PAG='45/60/90' THEN 52.5
WHEN AA.COND_PAG='45/70' THEN 57.5
WHEN AA.COND_PAG='45/75/105' THEN 75
WHEN AA.COND_PAG='47 DDL' THEN 47
WHEN AA.COND_PAG='49 DDL' THEN 49
WHEN AA.COND_PAG='49/56' THEN 52.5
WHEN AA.COND_PAG='49/56/63' THEN 56
WHEN AA.COND_PAG='49/56/63/70/77/84/91/98' THEN 73.5
WHEN AA.COND_PAG='49/63/77/98' THEN 71.75
WHEN AA.COND_PAG='50 DDL' THEN 50
WHEN AA.COND_PAG='50/60' THEN 55
WHEN AA.COND_PAG='50/60/70' THEN 60
WHEN AA.COND_PAG='50/60/70/80/90' THEN 70
WHEN AA.COND_PAG='50/65/80/95' THEN 72.5
WHEN AA.COND_PAG='52 DDL' THEN 52
WHEN AA.COND_PAG='53/60/67' THEN 60
WHEN AA.COND_PAG='55/60/65/70/75/80/85/90/95' THEN 75
WHEN AA.COND_PAG='56 DDL' THEN 56
WHEN AA.COND_PAG='56/60' THEN 58
WHEN AA.COND_PAG='56/63' THEN 59.5
WHEN AA.COND_PAG='56/63/70' THEN 63
WHEN AA.COND_PAG='56/63/70/120' THEN 77.25
WHEN AA.COND_PAG='56/70/84/98/112' THEN 84
WHEN AA.COND_PAG='56/84' THEN 70
WHEN AA.COND_PAG='60 DDL' THEN 60
WHEN AA.COND_PAG='60 DDL Pagto Quinta Feira' THEN 60
WHEN AA.COND_PAG='60 DDL Pagto Sexta Feira' THEN 60
WHEN AA.COND_PAG='60/63/70/73' THEN 66.5
WHEN AA.COND_PAG='60/67' THEN 63.5
WHEN AA.COND_PAG='60/67/74/81/88/95' THEN 77.5
WHEN AA.COND_PAG='60/70/80' THEN 70
WHEN AA.COND_PAG='60/70/80/90' THEN 75
WHEN AA.COND_PAG='60/75' THEN 67.5
WHEN AA.COND_PAG='60/75/90' THEN 75
WHEN AA.COND_PAG='60/75/90/105' THEN 82.5
WHEN AA.COND_PAG='60/90' THEN 75
WHEN AA.COND_PAG='60/90/120' THEN 90
WHEN AA.COND_PAG='63 DDL' THEN 63
WHEN AA.COND_PAG='63/70/77' THEN 70
WHEN AA.COND_PAG='63/70/77/84/91/98/105/112' THEN 87.5
WHEN AA.COND_PAG='68 DDL' THEN 68
WHEN AA.COND_PAG='69 DDL' THEN 69
WHEN AA.COND_PAG='7/14/21/28/35/42/49/56/63/70' THEN 38.5
WHEN AA.COND_PAG='70 DDL' THEN 70
WHEN AA.COND_PAG='75 DDL' THEN 75
WHEN AA.COND_PAG='75/90/105' THEN 90
WHEN AA.COND_PAG='77/84/91/98/105/112' THEN 94.5
WHEN AA.COND_PAG='79 DDL' THEN 79
WHEN AA.COND_PAG='80 DDL' THEN 80
WHEN AA.COND_PAG='85 DDL' THEN 85
WHEN AA.COND_PAG='85 DDL Pgtos dia 01 e 16' THEN 85
WHEN AA.COND_PAG='86 DDL' THEN 86
WHEN AA.COND_PAG='87DDL' THEN 87
WHEN AA.COND_PAG='88 DDL' THEN 88
WHEN AA.COND_PAG='89 DDL' THEN 89
WHEN AA.COND_PAG='90 DDL' THEN 90
WHEN AA.COND_PAG='90 DDL Pagto Sexta Feira' THEN 90
WHEN AA.COND_PAG='90/100/110/120' THEN 105
WHEN AA.COND_PAG='90/120' THEN 105
WHEN AA.COND_PAG='91 DDL' THEN 91
WHEN AA.COND_PAG='93 DDL' THEN 93
WHEN AA.COND_PAG='95 DDL' THEN 95
WHEN AA.COND_PAG='96 DDL' THEN 96
WHEN AA.COND_PAG='A VISTA' THEN 1
WHEN AA.COND_PAG='ANTECIPADO' THEN 1
WHEN AA.COND_PAG='REMESSA' THEN 0
WHEN AA.COND_PAG='RESERV. MODULO COMPRAS' THEN 0
WHEN AA.COND_PAG='84 DDL' THEN 84
WHEN AA.COND_PAG='63/70/77/84/91/98' THEN 80.5
WHEN AA.COND_PAG='35 DDL Pagto Ter-Qui' THEN 35
WHEN AA.COND_PAG='94 DDL' THEN 94
WHEN AA.COND_PAG='28 DDL Ter Qua Qui Sex' THEN 28
WHEN AA.COND_PAG='AMOSTRA GRATIS' THEN 0
WHEN AA.COND_PAG='27/34/41' THEN 34
WHEN AA.COND_PAG='28/35/42 Pagto Quinta Feira' THEN 35
WHEN AA.COND_PAG='20/30/40/50/60/70' THEN 45
WHEN AA.COND_PAG='28/35/42/49/56/63/70 TER-QUIN' THEN 49
WHEN AA.COND_PAG='1/30 DDL' THEN 15
WHEN AA.COND_PAG='18 DDL' THEN 18
WHEN AA.COND_PAG='30/60 Pagto Quinta Feira' THEN 45
WHEN AA.COND_PAG='35/49/56' THEN 49
WHEN AA.COND_PAG='28/35/42/48' THEN 38
WHEN AA.COND_PAG='45 DDL Pagto Quinta Feira' THEN 45

WHEN AA.COND_PAG='56/72' THEN 64
WHEN AA.COND_PAG='60 Pagto dia 08 e 23' THEN 60
WHEN AA.COND_PAG='28/42/70/84' THEN 56
WHEN AA.COND_PAG='40/50' THEN 55
WHEN AA.COND_PAG='65 DDL' THEN 65
WHEN AA.COND_PAG='45/55/65/75' THEN 60
WHEN AA.COND_PAG='45/60/75/90/105' THEN 75
WHEN AA.COND_PAG='35/40/45' THEN 40
WHEN AA.COND_PAG='10/20/30' THEN 20
WHEN AA.COND_PAG='28/42/56' THEN 42
WHEN AA.COND_PAG='49/63/70' THEN 63
WHEN AA.COND_PAG='45/60/90' THEN 60
WHEN AA.COND_PAG='45/52/59/66/73/80' THEN 62.5
WHEN AA.COND_PAG='32/39/46' THEN 39
WHEN AA.COND_PAG='93DDL Pagto 05 e 20' THEN 93
WHEN AA.COND_PAG='73 DDL' THEN 73
WHEN AA.COND_PAG='05 DDL' THEN 5
WHEN AA.COND_PAG='5 DDL' THEN 5
WHEN AA.COND_PAG='62 DDL' THEN 62
WHEN AA.COND_PAG='42 DDL' THEN 42
WHEN AA.COND_PAG='105' THEN 105
WHEN AA.COND_PAG='150' THEN 150
WHEN AA.COND_PAG='105 DDL' THEN 105
WHEN AA.COND_PAG='150 DDL' THEN 150

WHEN AA.COND_PAG='100DDL Pagto Sexta-Feira' THEN 100
WHEN AA.COND_PAG='100DDL Pagto Terça-Feira' THEN 100
WHEN AA.COND_PAG='100 DDL' THEN 100

ELSE 0 
END MEDIA_COND_PAG,

case 
when MEDIAM is not null then MEDIAM
WHEN AA.COND_PAG='07/14' THEN 10.5
WHEN AA.COND_PAG='7/14' THEN 10.5
WHEN AA.COND_PAG='10/20' THEN 15
WHEN AA.COND_PAG='0/15' THEN 7.5
WHEN AA.COND_PAG='0/30/60' THEN 30
WHEN AA.COND_PAG='03 DDL' THEN 3
WHEN AA.COND_PAG='07 DDL' THEN 7
WHEN AA.COND_PAG='07/14/21' THEN 14
WHEN AA.COND_PAG='07/14/21/28' THEN 17.5
WHEN AA.COND_PAG='10 DDL' THEN 10
WHEN AA.COND_PAG='10/20/30/40/50/60/70/80/90' THEN 50
WHEN AA.COND_PAG='100DDL Pagto Terça-Feira' THEN 100
WHEN AA.COND_PAG='103/108/113' THEN 108
WHEN AA.COND_PAG='110 DDL' THEN 110
WHEN AA.COND_PAG='110/120/130' THEN 120
WHEN AA.COND_PAG='12 DDL' THEN 12
WHEN AA.COND_PAG='120 DDL' THEN 120
WHEN AA.COND_PAG='120 DDL - Pagto 05 e 20' THEN 120
WHEN AA.COND_PAG='14 DDL' THEN 14
WHEN AA.COND_PAG='14/21' THEN 17.5
WHEN AA.COND_PAG='14/21/28' THEN 21
WHEN AA.COND_PAG='14/21/28/35' THEN 24.5
WHEN AA.COND_PAG='14/21/28/35/42/49            ' THEN 28
WHEN AA.COND_PAG='14/21/28/35/42/49/56' THEN 35
WHEN AA.COND_PAG='14/28' THEN 21
WHEN AA.COND_PAG='15 DDL' THEN 15
WHEN AA.COND_PAG='15/20/30/35                  ' THEN 25
WHEN AA.COND_PAG='15/21/28/35' THEN 24.75
WHEN AA.COND_PAG='15/25                        ' THEN 15
WHEN AA.COND_PAG='15/30' THEN 22.5
WHEN AA.COND_PAG='15/30/45                     ' THEN 30
WHEN AA.COND_PAG='15/30/45/60                  ' THEN 37.5
WHEN AA.COND_PAG='15/30/45/60/75' THEN 45
WHEN AA.COND_PAG='18/25/32/39/43' THEN 31.4
WHEN AA.COND_PAG='180 DDL' THEN 180
WHEN AA.COND_PAG='2 DDL' THEN 2
WHEN AA.COND_PAG='20 DDL Pagto 3a 4a 5a 6a' THEN 20
WHEN AA.COND_PAG='20/30/40' THEN 30
WHEN AA.COND_PAG='20/30/40/50/60' THEN 40
WHEN AA.COND_PAG='20/40' THEN 30
WHEN AA.COND_PAG='20/40/60' THEN 40
WHEN AA.COND_PAG='20/40/60/80' THEN 50
WHEN AA.COND_PAG='21 DDL' THEN 21
WHEN AA.COND_PAG='21/28' THEN 24.5
WHEN AA.COND_PAG='21/28/35' THEN 28
WHEN AA.COND_PAG='21/28/35/42' THEN 31.5
WHEN AA.COND_PAG='21/28/35/42/49' THEN 35
WHEN AA.COND_PAG='21/28/35/42/49/56' THEN 38.5
WHEN AA.COND_PAG='21/28/35/42/49/56/63' THEN 42
WHEN AA.COND_PAG='21/28/35/42/49/56/63/70' THEN 45.5
WHEN AA.COND_PAG='21/28/35/42/49/56/63/70/77/84' THEN 52.5
WHEN AA.COND_PAG='21/35/42' THEN 32.66666667
WHEN AA.COND_PAG='21/42                        ' THEN 31.5
WHEN AA.COND_PAG='21/42/56' THEN 39.66666667
WHEN AA.COND_PAG='23/46' THEN 34.5
WHEN AA.COND_PAG='24/31/38/45                  ' THEN 34.5
WHEN AA.COND_PAG='24/34/44/54/64/74' THEN 49
WHEN AA.COND_PAG='25 DDL' THEN 25
WHEN AA.COND_PAG='25/35/42                     ' THEN 35
WHEN AA.COND_PAG='27/34' THEN 30.5
WHEN AA.COND_PAG='270 DDL' THEN 270
WHEN AA.COND_PAG='28 DDL' THEN 28
WHEN AA.COND_PAG='28 DDL Pagto 01 e 16' THEN 28
WHEN AA.COND_PAG='28 DDL Pagto Quarta-feira' THEN 28
WHEN AA.COND_PAG='28/35' THEN 31.5
WHEN AA.COND_PAG='28/35/42' THEN 35
WHEN AA.COND_PAG='28/35/42 Pgto Quarta Feira' THEN 35
WHEN AA.COND_PAG='28/35/42/49' THEN 38.5
WHEN AA.COND_PAG='28/35/42/49 Pgto Qua-Sex' THEN 38.5
WHEN AA.COND_PAG='28/35/42/49/56' THEN 42
WHEN AA.COND_PAG='28/35/42/49/56/62/69         ' THEN 49
WHEN AA.COND_PAG='28/35/42/49/56/62/69/75/82/89' THEN 58.7
WHEN AA.COND_PAG='28/35/42/49/56/63' THEN 45.5
WHEN AA.COND_PAG='28/35/42/49/56/63 SEXTA' THEN 45.5
WHEN AA.COND_PAG='28/35/42/49/56/63/70' THEN 49
WHEN AA.COND_PAG='28/35/42/49/56/63/70 Quarta' THEN 49
WHEN AA.COND_PAG='28/35/42/49/56/63/70 ' THEN 45.5
WHEN AA.COND_PAG='28/35/42/49/56/63/70/77' THEN 52.5
WHEN AA.COND_PAG='28/35/42/49/56/63/70/77/84 ' THEN 52.5
WHEN AA.COND_PAG='28/35/42/49/56/63/70/77/84/91' THEN 59.5
WHEN AA.COND_PAG='28/35/42/49/57' THEN 42.2
WHEN AA.COND_PAG='28/35/42/49/60' THEN 42.8
WHEN AA.COND_PAG='28/35/42/49/65' THEN 43.8
WHEN AA.COND_PAG='28/35/42/50 ' THEN 35
WHEN AA.COND_PAG='28/35/42/56' THEN 40.25
WHEN AA.COND_PAG='28/35/42/56/63' THEN 44.8
WHEN AA.COND_PAG='28/38' THEN 33
WHEN AA.COND_PAG='28/42' THEN 35
WHEN AA.COND_PAG='28/42/56' THEN 42
WHEN AA.COND_PAG='28/42/56' THEN 42
WHEN AA.COND_PAG='28/42/56/63/70' THEN 56
WHEN AA.COND_PAG='28/42/56/70' THEN 49
WHEN AA.COND_PAG='28/42/56/70/84' THEN 56
WHEN AA.COND_PAG='28/42/56/70/84/98' THEN 63
WHEN AA.COND_PAG='28/42/56/70/84/98/112        ' THEN 70
WHEN AA.COND_PAG='28/42/56/77/91' THEN 58.8
WHEN AA.COND_PAG='28/42/70/84' THEN 46.66666667
WHEN AA.COND_PAG='28/45' THEN 36.5
WHEN AA.COND_PAG='28/45/62' THEN 36.5
WHEN AA.COND_PAG='28/56' THEN 42
WHEN AA.COND_PAG='28/56 Pagto Ter-Quin' THEN 42
WHEN AA.COND_PAG='28/56/84' THEN 56
WHEN AA.COND_PAG='28/56/84 ' THEN 42
WHEN AA.COND_PAG='28/56/84/112' THEN 70
WHEN AA.COND_PAG='29 DDL' THEN 29
WHEN AA.COND_PAG='30 DDL' THEN 30
WHEN AA.COND_PAG='30 DDL TER QUA QUI SEX' THEN 30
WHEN AA.COND_PAG='30/35/40/45/50/55/60' THEN 45
WHEN AA.COND_PAG='30/35/40/45/50/55/60/65/70/75' THEN 52.5
WHEN AA.COND_PAG='30/37/45/52/60               ' THEN 41
WHEN AA.COND_PAG='30/38/45/52/60' THEN 45
WHEN AA.COND_PAG='30/38/45/60' THEN 43.25
WHEN AA.COND_PAG='30/40                        ' THEN 35
WHEN AA.COND_PAG='30/40/50' THEN 40
WHEN AA.COND_PAG='30/40/50/60' THEN 45
WHEN AA.COND_PAG='30/40/50/60/70' THEN 50
WHEN AA.COND_PAG='30/40/50/60/70/80/90' THEN 60
WHEN AA.COND_PAG='30/40/50/65/70/85/106/116/126' THEN 76.44444444
WHEN AA.COND_PAG='30/42' THEN 36
WHEN AA.COND_PAG='30/45' THEN 37.5
WHEN AA.COND_PAG='30/45/60' THEN 45
WHEN AA.COND_PAG='30/45/60 Pagto Ter-Quin' THEN 45
WHEN AA.COND_PAG='30/45/60/75' THEN 52.5
WHEN AA.COND_PAG='30/45/60/75/90' THEN 60
WHEN AA.COND_PAG='30/45/60/75/90 TER - QUIN' THEN 60
WHEN AA.COND_PAG='30/45/60/75/90/105' THEN 67.5
WHEN AA.COND_PAG='30/52/70' THEN 50.66666667
WHEN AA.COND_PAG='30/60' THEN 45
WHEN AA.COND_PAG='30/60 Pagto dia 10 e 25' THEN 45
WHEN AA.COND_PAG='30/60/90' THEN 60
WHEN AA.COND_PAG='30/60/90 Ter - Quin' THEN 60
WHEN AA.COND_PAG='30/60/90/120' THEN 75
WHEN AA.COND_PAG='30/60/90/120/150' THEN 90
WHEN AA.COND_PAG='31 DDL' THEN 31
WHEN AA.COND_PAG='33 DDL' THEN 33
WHEN AA.COND_PAG='34 DDL' THEN 34
WHEN AA.COND_PAG='35 DDL' THEN 35
WHEN AA.COND_PAG='35/40/45' THEN 37.5
WHEN AA.COND_PAG='35/42' THEN 38.5
WHEN AA.COND_PAG='35/42/49' THEN 42
WHEN AA.COND_PAG='35/42/49/56' THEN 45.5
WHEN AA.COND_PAG='35/42/49/56/63' THEN 49
WHEN AA.COND_PAG='35/42/49/56/63 Pagto Quinta' THEN 49
WHEN AA.COND_PAG='35/42/49/56/63/70' THEN 52.5
WHEN AA.COND_PAG='35/42/49/56/63/70/77' THEN 56
WHEN AA.COND_PAG='35/42/49/56/63/70/77/84' THEN 59.5
WHEN AA.COND_PAG='35/42/49/56/63/70/77/84/91' THEN 63
WHEN AA.COND_PAG='35/42/49/56/63/70/77/84/91/98' THEN 66.5
WHEN AA.COND_PAG='35/42/49/56/63/70/77/85' THEN 59.625
WHEN AA.COND_PAG='35/42/50' THEN 42.333333
WHEN AA.COND_PAG='35/42/56' THEN 42
WHEN AA.COND_PAG='35/45' THEN 40
WHEN AA.COND_PAG='35/45/52' THEN 44
WHEN AA.COND_PAG='35/45/52/60' THEN 48
WHEN AA.COND_PAG='35/45/55' THEN 45
WHEN AA.COND_PAG='35/45/55 - 10/20/30' THEN 45
WHEN AA.COND_PAG='35/45/55/65 - 10/20/30' THEN 50
WHEN AA.COND_PAG='35/45/55/65/75' THEN 55
WHEN AA.COND_PAG='35/45/55/65/75 - 07/17/27' THEN 55
WHEN AA.COND_PAG='35/45/60' THEN 45
WHEN AA.COND_PAG='35/47/59/71/83/95/107/119/131' THEN 83
WHEN AA.COND_PAG='35/49/56/63/70/77/84' THEN 62
WHEN AA.COND_PAG='35/49/60' THEN 48
WHEN AA.COND_PAG='35/49/63                     ' THEN 49
WHEN AA.COND_PAG='35/49/63/77/91' THEN 63
WHEN AA.COND_PAG='35/50' THEN 42.5
WHEN AA.COND_PAG='35/50/65/75' THEN 56.25
WHEN AA.COND_PAG='35/55/75' THEN 55
WHEN AA.COND_PAG='35/56/77' THEN 56
WHEN AA.COND_PAG='35/63' THEN 49
WHEN AA.COND_PAG='35/63/91' THEN 63
WHEN AA.COND_PAG='37 DDL' THEN 37
WHEN AA.COND_PAG='38 DDL' THEN 38
WHEN AA.COND_PAG='38/45/52' THEN 45
WHEN AA.COND_PAG='39/59/79' THEN 59
WHEN AA.COND_PAG='40 DDL' THEN 40
WHEN AA.COND_PAG='40/50/60' THEN 50
WHEN AA.COND_PAG='40/50/60/70/80' THEN 60
WHEN AA.COND_PAG='40/50/60/70/80/90' THEN 65
WHEN AA.COND_PAG='40/50/60/70/80/90/100' THEN 70
WHEN AA.COND_PAG='40/60/75' THEN 60
WHEN AA.COND_PAG='41 DDL' THEN 41
WHEN AA.COND_PAG='42 DDL' THEN 42
WHEN AA.COND_PAG='42/49' THEN 45.5
WHEN AA.COND_PAG='42/49/56' THEN 49
WHEN AA.COND_PAG='42/49/56/63' THEN 52.5
WHEN AA.COND_PAG='42/49/56/63/70' THEN 56
WHEN AA.COND_PAG='42/49/56/63/70/77' THEN 59.5
WHEN AA.COND_PAG='42/49/56/63/70/77/84' THEN 59.5
WHEN AA.COND_PAG='42/49/56/63/70/77/84/91' THEN 66.5
WHEN AA.COND_PAG='42/56' THEN 49
WHEN AA.COND_PAG='42/56/65' THEN 54.33333333
WHEN AA.COND_PAG='42/56/70' THEN 56
WHEN AA.COND_PAG='42/56/70/84/98' THEN 70
WHEN AA.COND_PAG='42/56/70/84/98/112' THEN 77
WHEN AA.COND_PAG='42/70/98' THEN 70
WHEN AA.COND_PAG='43 DDL' THEN 43
WHEN AA.COND_PAG='44 DDL' THEN 44
WHEN AA.COND_PAG='45 DDL' THEN 45
WHEN AA.COND_PAG='45/50/55/60/65/70/75/80/85' THEN 62.5
WHEN AA.COND_PAG='45/52' THEN 48.5
WHEN AA.COND_PAG='45/52/59' THEN 52
WHEN AA.COND_PAG='45/52/59/66/73/80' THEN 59
WHEN AA.COND_PAG='45/52/60' THEN 52.33333333
WHEN AA.COND_PAG='45/53' THEN 49
WHEN AA.COND_PAG='45/55/65' THEN 55
WHEN AA.COND_PAG='45/55/65/75' THEN 55
WHEN AA.COND_PAG='45/60' THEN 52.5
WHEN AA.COND_PAG='45/60/75' THEN 60
WHEN AA.COND_PAG='45/60/75/90' THEN 67.5
WHEN AA.COND_PAG='45/60/75/90/105' THEN 67.5
WHEN AA.COND_PAG='45/60/75/90/115' THEN 77
WHEN AA.COND_PAG='45/60/90' THEN 52.5
WHEN AA.COND_PAG='45/70' THEN 57.5
WHEN AA.COND_PAG='45/75/105' THEN 75
WHEN AA.COND_PAG='47 DDL' THEN 47
WHEN AA.COND_PAG='49 DDL' THEN 49
WHEN AA.COND_PAG='49/56' THEN 52.5
WHEN AA.COND_PAG='49/56/63' THEN 56
WHEN AA.COND_PAG='49/56/63/70/77/84/91/98' THEN 73.5
WHEN AA.COND_PAG='49/63/77/98' THEN 71.75
WHEN AA.COND_PAG='50 DDL' THEN 50
WHEN AA.COND_PAG='50/60' THEN 55
WHEN AA.COND_PAG='50/60/70' THEN 60
WHEN AA.COND_PAG='50/60/70/80/90' THEN 70
WHEN AA.COND_PAG='50/65/80/95' THEN 72.5
WHEN AA.COND_PAG='52 DDL' THEN 52
WHEN AA.COND_PAG='53/60/67' THEN 60
WHEN AA.COND_PAG='55/60/65/70/75/80/85/90/95' THEN 75
WHEN AA.COND_PAG='56 DDL' THEN 56
WHEN AA.COND_PAG='56/60' THEN 58
WHEN AA.COND_PAG='56/63' THEN 59.5
WHEN AA.COND_PAG='56/63/70' THEN 63
WHEN AA.COND_PAG='56/63/70/120' THEN 77.25
WHEN AA.COND_PAG='56/70/84/98/112' THEN 84
WHEN AA.COND_PAG='56/84' THEN 70
WHEN AA.COND_PAG='60 DDL' THEN 60
WHEN AA.COND_PAG='60 DDL Pagto Quinta Feira' THEN 60
WHEN AA.COND_PAG='60 DDL Pagto Sexta Feira' THEN 60
WHEN AA.COND_PAG='60/63/70/73' THEN 66.5
WHEN AA.COND_PAG='60/67' THEN 63.5
WHEN AA.COND_PAG='60/67/74/81/88/95' THEN 77.5
WHEN AA.COND_PAG='60/70/80' THEN 70
WHEN AA.COND_PAG='60/70/80/90' THEN 75
WHEN AA.COND_PAG='60/75' THEN 67.5
WHEN AA.COND_PAG='60/75/90' THEN 75
WHEN AA.COND_PAG='60/75/90/105' THEN 82.5
WHEN AA.COND_PAG='60/90' THEN 75
WHEN AA.COND_PAG='60/90/120' THEN 90
WHEN AA.COND_PAG='63 DDL' THEN 63
WHEN AA.COND_PAG='63/70/77' THEN 70
WHEN AA.COND_PAG='63/70/77/84/91/98/105/112' THEN 87.5
WHEN AA.COND_PAG='68 DDL' THEN 68
WHEN AA.COND_PAG='69 DDL' THEN 69
WHEN AA.COND_PAG='7/14/21/28/35/42/49/56/63/70' THEN 38.5
WHEN AA.COND_PAG='70 DDL' THEN 70
WHEN AA.COND_PAG='75 DDL' THEN 75
WHEN AA.COND_PAG='75/90/105' THEN 90
WHEN AA.COND_PAG='77/84/91/98/105/112' THEN 94.5
WHEN AA.COND_PAG='79 DDL' THEN 79
WHEN AA.COND_PAG='80 DDL' THEN 80
WHEN AA.COND_PAG='85 DDL' THEN 85
WHEN AA.COND_PAG='85 DDL Pgtos dia 01 e 16' THEN 85
WHEN AA.COND_PAG='86 DDL' THEN 86
WHEN AA.COND_PAG='87DDL' THEN 87
WHEN AA.COND_PAG='88 DDL' THEN 88
WHEN AA.COND_PAG='89 DDL' THEN 89
WHEN AA.COND_PAG='90 DDL' THEN 90
WHEN AA.COND_PAG='90 DDL Pagto Sexta Feira' THEN 90
WHEN AA.COND_PAG='90/100/110/120' THEN 105
WHEN AA.COND_PAG='90/120' THEN 105
WHEN AA.COND_PAG='91 DDL' THEN 91
WHEN AA.COND_PAG='93 DDL' THEN 93
WHEN AA.COND_PAG='95 DDL' THEN 95
WHEN AA.COND_PAG='96 DDL' THEN 96
WHEN AA.COND_PAG='A VISTA' THEN 1
WHEN AA.COND_PAG='ANTECIPADO' THEN 1
WHEN AA.COND_PAG='REMESSA' THEN 0
WHEN AA.COND_PAG='RESERV. MODULO COMPRAS' THEN 0
WHEN AA.COND_PAG='84 DDL' THEN 84
WHEN AA.COND_PAG='63/70/77/84/91/98' THEN 80.5
WHEN AA.COND_PAG='35 DDL Pagto Ter-Qui' THEN 35
WHEN AA.COND_PAG='94 DDL' THEN 94
WHEN AA.COND_PAG='28 DDL Ter Qua Qui Sex' THEN 28
WHEN AA.COND_PAG='AMOSTRA GRATIS' THEN 0
WHEN AA.COND_PAG='27/34/41' THEN 34
WHEN AA.COND_PAG='28/35/42 Pagto Quinta Feira' THEN 35
WHEN AA.COND_PAG='20/30/40/50/60/70' THEN 45
WHEN AA.COND_PAG='28/35/42/49/56/63/70 TER-QUIN' THEN 49
WHEN AA.COND_PAG='1/30 DDL' THEN 15
WHEN AA.COND_PAG='18 DDL' THEN 18
WHEN AA.COND_PAG='30/60 Pagto Quinta Feira' THEN 45
WHEN AA.COND_PAG='35/49/56' THEN 49
WHEN AA.COND_PAG='28/35/42/48' THEN 38
WHEN AA.COND_PAG='45 DDL Pagto Quinta Feira' THEN 45

WHEN AA.COND_PAG='56/72' THEN 64
WHEN AA.COND_PAG='60 Pagto dia 08 e 23' THEN 60
WHEN AA.COND_PAG='28/42/70/84' THEN 56
WHEN AA.COND_PAG='40/50' THEN 55
WHEN AA.COND_PAG='65 DDL' THEN 65
WHEN AA.COND_PAG='45/55/65/75' THEN 60
WHEN AA.COND_PAG='45/60/75/90/105' THEN 75
WHEN AA.COND_PAG='35/40/45' THEN 40
WHEN AA.COND_PAG='10/20/30' THEN 20
WHEN AA.COND_PAG='28/42/56' THEN 42
WHEN AA.COND_PAG='49/63/70' THEN 63
WHEN AA.COND_PAG='45/60/90' THEN 60
WHEN AA.COND_PAG='45/52/59/66/73/80' THEN 62.5
WHEN AA.COND_PAG='32/39/46' THEN 39
WHEN AA.COND_PAG='93DDL Pagto 05 e 20' THEN 93
WHEN AA.COND_PAG='73 DDL' THEN 73
WHEN AA.COND_PAG='05 DDL' THEN 5
WHEN AA.COND_PAG='5 DDL' THEN 5
WHEN AA.COND_PAG='62 DDL' THEN 62
WHEN AA.COND_PAG='42 DDL' THEN 42
WHEN AA.COND_PAG='105' THEN 105
WHEN AA.COND_PAG='150' THEN 150
WHEN AA.COND_PAG='105 DDL' THEN 105
WHEN AA.COND_PAG='150 DDL' THEN 150

WHEN AA.COND_PAG='100DDL Pagto Sexta-Feira' THEN 100
WHEN AA.COND_PAG='100DDL Pagto Terça-Feira' THEN 100
WHEN AA.COND_PAG='100 DDL' THEN 100

ELSE 0 

end MEDIA_FINAN

 FROM DADOS AA
                        --AMARRA??O ICMS
                          left outer join PRODDTA.F0116 AL on AA.COD_FORNECEDOR = AL.ALAN8
                                              LEFT JOIN SY920.F0092 ON TRIM(ORIGINADOR)=TRIM(ULUSER) 
                                              LEFT JOIN PRODDTA.F0101 ON ABAN8=ULAN8
											  LEFT JOIN MAX_CP ON PEDIDO=PEDIDOM AND PEDIDO_LINHA=LINHAM AND TIPO=TIPOM AND CIA=CIAM AND  COD=CODM 
                                                                            --FIM ICMS
;

